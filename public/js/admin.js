!function(e){e("#group_list table").sortable({containerSelector:"table",itemPath:"> tbody",itemSelector:"tr",placeholder:'<tr class="placeholder"/>',delay:500,onDrop:function(i,t,n){n(i,t);var a=[];e("tbody tr td:first-child",t.el[0]).each(function(i,t){a.push(e(t).data("group-id"))}),e.ajax({url:"/admin/groups/reorder",method:"POST",data:{groups:a}})}}),e("#group").on("show.bs.modal",function(i){var t=e(i.relatedTarget),n=e(this),a=trans("groups.create");e(".btn-danger",n).hide(),e(".callout-danger",n).hide(),e(".has-error",n).removeClass("has-error"),e(".label-danger",n).remove(),t.hasClass("btn-edit")?(a=trans("groups.edit"),e(".btn-danger",n).show()):(e("#group_id").val(""),e("#group_name").val("")),n.find(".modal-title span").text(a)}),e("body").delegate(".group-trash button.btn-delete","click",function(i){var t=e(i.currentTarget),n=t.find("i"),a=t.parents(".modal");n.removeClass().addClass("piplin piplin-load piplin-spin"),a.find("input").attr("disabled","disabled"),e("button.close",a).hide(),Piplin.Groups.get(e("#model_id").val()).destroy({wait:!0,success:function(i,t,s){a.modal("hide"),e(".callout-danger",a).hide(),n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled"),Piplin.toast(trans("groups.delete_success"))},error:function(){n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled")}})}),e("#group button.btn-save").on("click",function(i){var t=e(i.currentTarget),n=t.find("i"),a=t.parents(".modal");n.removeClass().addClass("piplin piplin-load piplin-spin"),a.find("input").attr("disabled","disabled"),e("button.close",a).hide();var s=e("#group_id").val();if(s)var l=Piplin.Groups.get(s);else var l=new Piplin.Group;l.save({name:e("#group_name").val()},{wait:!0,success:function(i,t,l){a.modal("hide"),e(".callout-danger",a).hide(),n.removeClass().addClass("piplin piplin-save"),e("button.close",a).show(),a.find("input").removeAttr("disabled");var r=trans("groups.edit_success");s||(Piplin.Groups.add(t),r=trans("groups.create_success")),Piplin.toast(r)},error:function(i,t,s){e(".callout-danger",a).show();var l=t.responseJSON;e(".has-error",a).removeClass("has-error"),e(".label-danger",a).remove(),e("form input",a).each(function(i,t){t=e(t);var n=t.attr("name");if(void 0!==l[n]){var a=t.parent("div");a.addClass("has-error"),a.append(e("<span>").attr("class","label label-danger").text(l[n]))}}),n.removeClass().addClass("piplin piplin-save"),e("button.close",a).show(),a.find("input").removeAttr("disabled")}})}),Piplin.Group=Backbone.Model.extend({urlRoot:"/admin/groups",initialize:function(){}});var i=Backbone.Collection.extend({model:Piplin.Group});Piplin.Groups=new i,Piplin.GroupsTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#group_list tbody"),e("#group_list").hide(),e("#no_groups").show(),this.listenTo(Piplin.Groups,"add",this.addOne),this.listenTo(Piplin.Groups,"reset",this.addAll),this.listenTo(Piplin.Groups,"remove",this.addAll),this.listenTo(Piplin.Groups,"all",this.render),Piplin.listener.on("projectgroup:"+Piplin.events.MODEL_CHANGED,function(i){e("#group_"+i.model.id).html(i.model.name);var t=Piplin.Groups.get(parseInt(i.model.id));t&&t.set(i.model)}),Piplin.listener.on("projectgroup:"+Piplin.events.MODEL_CREATED,function(e){Piplin.Groups.add(e.model)}),Piplin.listener.on("projectgroup:"+Piplin.events.MODEL_TRASHED,function(i){var t=Piplin.Groups.get(parseInt(i.model.id));t&&Piplin.Groups.remove(t),e("#group_"+i.model.id).parent("li").remove(),parseInt(i.model.id)===parseInt(Piplin.group_id)&&(window.location.href="/")})},render:function(){Piplin.Groups.length?(e("#no_groups").hide(),e("#group_list").show()):(e("#no_groups").show(),e("#group_list").hide())},addOne:function(e){var i=new Piplin.GroupView({model:e});this.$list.append(i.render().el)},addAll:function(){this.$list.html(""),Piplin.Groups.each(this.addOne,this)}}),Piplin.GroupView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"edit","click .btn-delete":"trash"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#group-template").html())},render:function(){var e=this.model.toJSON();return this.$el.html(this.template(e)),this},edit:function(){e("#group_id").val(this.model.id),e("#group_name").val(this.model.get("name"))},trash:function(){var i=e("#model_id");i.val(this.model.id),i.parents(".modal").removeClass().addClass("modal fade group-trash")}})}(jQuery),function(e){e("#provider_list table").sortable({containerSelector:"table",itemPath:"> tbody",itemSelector:"tr",placeholder:'<tr class="placeholder"/>',delay:500,onDrop:function(i,t,n){n(i,t);var a=[];e("tbody tr td:first-child",t.el[0]).each(function(i,t){a.push(e(t).data("provider-id"))}),e.ajax({url:"/admin/providers/reorder",method:"POST",data:{providers:a}})}}),e("#provider").on("show.bs.modal",function(i){var t=e(i.relatedTarget),n=e(this),a=trans("providers.create");e(".btn-danger",n).hide(),e(".callout-danger",n).hide(),e(".has-error",n).removeClass("has-error"),e(".label-danger",n).remove(),t.hasClass("btn-edit")?(a=trans("providers.edit"),e(".btn-danger",n).show()):(e("#provider_id").val(""),e("#provider_name").val(""),e("#provider_slug").val(""),e("#provider_icon").val(""),e("#provider_description").val("")),n.find(".modal-title span").text(a)}),e("body").delegate(".provider-trash button.btn-delete","click",function(i){var t=e(i.currentTarget),n=t.find("i"),a=t.parents(".modal");n.removeClass().addClass("piplin piplin-load piplin-spin"),a.find("input").attr("disabled","disabled"),e("button.close",a).hide(),Piplin.Providers.get(e("#model_id").val()).destroy({wait:!0,success:function(i,t,s){a.modal("hide"),e(".callout-danger",a).hide(),n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled"),Piplin.toast(trans("providers.delete_success"))},error:function(){n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled")}})}),e("#provider button.btn-save").on("click",function(i){var t=e(i.currentTarget),n=t.find("i"),a=t.parents(".modal");n.removeClass().addClass("piplin piplin-load piplin-spin"),a.find("input").attr("disabled","disabled"),e("button.close",a).hide();var s=e("#provider_id").val();if(s)var l=Piplin.Providers.get(s);else var l=new Piplin.Provider;l.save({name:e("#provider_name").val(),slug:e("#provider_slug").val(),icon:e("#provider_icon").val(),description:e("#provider_description").val()},{wait:!0,success:function(i,t,l){a.modal("hide"),e(".callout-danger",a).hide(),n.removeClass().addClass("piplin piplin-save"),e("button.close",a).show(),a.find("input").removeAttr("disabled");var r=trans("providers.edit_success");s||(Piplin.Providers.add(t),r=trans("providers.create_success")),Piplin.toast(r)},error:function(i,t,s){e(".callout-danger",a).show();var l=t.responseJSON;e(".has-error",a).removeClass("has-error"),e(".label-danger",a).remove(),e("form input",a).each(function(i,t){t=e(t);var n=t.attr("name");if(void 0!==l[n]){var a=t.parent("div");a.addClass("has-error"),a.append(e("<span>").attr("class","label label-danger").text(l[n]))}}),n.removeClass().addClass("piplin piplin-save"),e("button.close",a).show(),a.find("input").removeAttr("disabled")}})}),Piplin.Provider=Backbone.Model.extend({urlRoot:"/admin/providers"});var i=Backbone.Collection.extend({model:Piplin.Provider,comparator:function(e,i){return e.get("name")>i.get("name")?-1:e.get("name")<i.get("name")?1:0}});Piplin.Providers=new i,Piplin.ProvidersTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#provider_list tbody"),e("#no_providers").show(),e("#provider_list").hide(),this.listenTo(Piplin.Providers,"add",this.addOne),this.listenTo(Piplin.Providers,"reset",this.addAll),this.listenTo(Piplin.Providers,"remove",this.addAll),this.listenTo(Piplin.Providers,"all",this.render),Piplin.listener.on("provider:"+Piplin.events.MODEL_CHANGED,function(e){var i=Piplin.providers.get(parseInt(e.model.id));i&&i.set(e.model)}),Piplin.listener.on("provider:"+Piplin.events.MODEL_CREATED,function(e){Piplin.Providers.add(e.model)}),Piplin.listener.on("provider:"+Piplin.events.MODEL_TRASHED,function(e){var i=Piplin.Providers.get(parseInt(e.model.id));i&&Piplin.Providers.remove(i)})},render:function(){Piplin.Providers.length?(e("#no_providers").hide(),e("#provider_list").show()):(e("#no_providers").show(),e("#provider_list").hide())},addOne:function(i){var t=new Piplin.ProviderView({model:i});this.$list.append(t.render().el),Piplin.Providers.length<2?e(".drag-handle",this.$list).hide():e(".drag-handle",this.$list).show()},addAll:function(){this.$list.html(""),Piplin.Providers.each(this.addOne,this)}}),Piplin.ProviderView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"edit","click .btn-delete":"trash"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#provider-template").html())},render:function(){var e=this.model.toJSON();return this.$el.html(this.template(e)),this},edit:function(){e("#provider_id").val(this.model.id),e("#provider_name").val(this.model.get("name")),e("#provider_slug").val(this.model.get("slug")),e("#provider_icon").val(this.model.get("icon")),e("#provider_description").val(this.model.get("description"))},trash:function(){var i=e("#model_id");i.val(this.model.id),i.parents(".modal").removeClass().addClass("modal fade provider-trash")}})}(jQuery),function(e){e("#project-clone").on("show.bs.modal",function(i){var t=e(this);e(".callout-danger",t).hide();var n=e("#skeleton_id").val();e("form",t).prop("action","/admin/projects/"+n+"/clone")}),e("#project-clone button.btn-save").on("click",function(i){var t=e(i.currentTarget);t.find("i"),t.parents(".modal")}),e("#project").on("show.bs.modal",function(i){var t=e(i.relatedTarget),n=e(this),a=trans("projects.create");e(".btn-danger",n).hide(),e(".callout-danger",n).hide(),e(".has-error",n).removeClass("has-error"),e(".label-danger",n).remove(),e(".nav-tabs a:first",n).tab("show"),t.hasClass("btn-edit")?(a=trans("projects.edit"),e(".btn-danger",n).show()):(e("#project_id").val(""),e("#project_name").val(""),e("#project_repository").val(""),e("#project_branch").val("master"),e("#project_targetable_id").select2(Piplin.select2_options).val(e("#project_targetable_id option:selected").val()).trigger("change"),e("#project_key_id").val(e("#project_key_id option:first").val()),e("#project_deploy_path").val(""),e("#project_builds_to_keep").val(10),e("#project_url").val(""),e("#project_build_url").val(""),e("#project_allow_other_branch").prop("checked",!0)),n.find(".modal-title span").text(a)}),e("body").delegate(".project-trash button.btn-delete","click",function(i){var t=e(i.currentTarget),n=t.find("i"),a=t.parents(".modal");n.removeClass().addClass("piplin piplin-load piplin-spin"),a.find("input").attr("disabled","disabled"),e("button.close",a).hide(),Piplin.Projects.get(e("#model_id").val()).destroy({wait:!0,success:function(i,t,s){a.modal("hide"),e(".callout-danger",a).hide(),n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled"),Piplin.toast(trans("projects.delete_success"))},error:function(){n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled")}})}),e("#project button.btn-save").on("click",function(i){var t=e(i.currentTarget),n=t.find("i"),a=t.parents(".modal");n.removeClass().addClass("piplin piplin-load piplin-spin"),a.find("input").attr("disabled","disabled"),e("button.close",a).hide();var s=e("#project_id").val();if(s)var l=Piplin.Projects.get(s);else var l=new Piplin.Project;l.save({name:e("#project_name").val(),repository:e("#project_repository").val(),branch:e("#project_branch").val(),targetable_id:e("#project_targetable_id").val(),key_id:e("#project_key_id").val(),deploy_path:e("#project_deploy_path").val(),builds_to_keep:e("#project_builds_to_keep").val(),url:e("#project_url").val(),build_url:e("#project_build_url").val(),allow_other_branch:e("#project_allow_other_branch").is(":checked")},{wait:!0,success:function(i,t,l){a.modal("hide"),e(".callout-danger",a).hide(),n.removeClass().addClass("piplin piplin-save"),e("button.close",a).show(),a.find("input").removeAttr("disabled");var r=trans("projects.edit_success");s||(Piplin.Projects.add(t),r=trans("projects.create_success")),Piplin.toast(r)},error:function(i,t,s){e(".callout-danger",a).show();var l=t.responseJSON;e(".has-error",a).removeClass("has-error"),e(".label-danger",a).remove(),e("form :input",a).each(function(i,t){t=e(t);var n=t.attr("name");if(void 0!==l[n]){var a=t.parent("div");a.addClass("has-error"),a.append(e("<span>").attr("class","label label-danger").text(l[n]))}}),n.removeClass().addClass("piplin piplin-save"),e("button.close",a).show(),a.find("input").removeAttr("disabled")}})}),Piplin.Project=Backbone.Model.extend({urlRoot:"/admin/projects"});var i=Backbone.Collection.extend({model:Piplin.Project});Piplin.Projects=new i,Piplin.ProjectsTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#project_list tbody"),e("#project_list").hide(),e("#no_projects").show(),this.listenTo(Piplin.Projects,"add",this.addOne),this.listenTo(Piplin.Projects,"reset",this.addAll),this.listenTo(Piplin.Projects,"remove",this.addAll),this.listenTo(Piplin.Projects,"all",this.render),Piplin.listener.on("project:"+Piplin.events.MODEL_CHANGED,function(e){var i=Piplin.Projects.get(parseInt(e.model.id));i&&(void 0==Piplin.group_id||Piplin.group_id==e.model.targetable_id?i.set(e.model):Piplin.Projects.remove(i))}),Piplin.listener.on("project:"+Piplin.events.MODEL_CREATED,function(e){Piplin.Projects.add(e.model)}),Piplin.listener.on("project:"+Piplin.events.MODEL_TRASHED,function(i){var t=Piplin.Projects.get(parseInt(i.model.id));t&&Piplin.Projects.remove(t),e("#project_"+i.model.id).parent("li").remove(),parseInt(i.model.id)===parseInt(Piplin.project_id)&&(window.location.href="/")})},render:function(){Piplin.Projects.length?(e("#no_projects").hide(),e("#project_list").show()):(e("#no_projects").show(),e("#project_list").hide())},addOne:function(e){var i=new Piplin.ProjectView({model:e});this.$list.append(i.render().el)},addAll:function(){this.$list.html(""),Piplin.Projects.each(this.addOne,this)}}),Piplin.ProjectView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"edit","click .btn-clone":"clone","click .btn-trash":"trash"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#project-template").html())},render:function(){var e=this.model.toJSON();return e.deployed=!!e.last_run&&moment(e.last_run).fromNow(),this.$el.html(this.template(e)),this},edit:function(){e("#project_id").val(this.model.id),e("#project_name").val(this.model.get("name")),e("#project_repository").val(this.model.get("repository")),e("#project_branch").val(this.model.get("branch")),e("#project_targetable_id").select2(Piplin.select2_options).val(this.model.get("targetable_id")).trigger("change"),e("#project_key_id").select2(Piplin.select2_options).val(this.model.get("key_id")).trigger("change"),e("#project_deploy_path").val(this.model.get("deploy_path")),e("#project_builds_to_keep").val(this.model.get("builds_to_keep")),e("#project_url").val(this.model.get("url")),e("#project_build_url").val(this.model.get("build_url")),e("#project_allow_other_branch").prop("checked",!0===this.model.get("allow_other_branch"))},clone:function(){e("#skeleton_id").val(this.model.id),e("#project_clone_name").val(this.model.get("name")+"_Clone")},trash:function(){var i=e("#model_id");i.val(this.model.id),i.parents(".modal").removeClass().addClass("modal fade project-trash")}})}(jQuery),function(e){e("#key_list table").sortable({containerSelector:"table",itemPath:"> tbody",itemSelector:"tr",placeholder:'<tr class="placeholder"/>',delay:500,onDrop:function(i,t,n){n(i,t);var a=[];e("tbody tr td:first-child",t.el[0]).each(function(i,t){a.push(e(t).data("key-id"))}),e.ajax({url:"/admin/keys/reorder",method:"POST",data:{keys:a}})}}),e("#key").on("show.bs.modal",function(i){var t=e(i.relatedTarget),n=e(this),a=trans("keys.create");e(".btn-danger",n).hide(),e(".callout-danger",n).hide(),e(".has-error",n).removeClass("has-error"),e(".label-danger",n).remove(),t.hasClass("btn-edit")?(a=trans("keys.edit"),e(".btn-danger",n).show()):(e("#key_id").val(""),e("#key_name").val(""),e("#key_private_key").val("")),n.find(".modal-title span").text(a)}),e("body").delegate(".key-trash button.btn-delete","click",function(i){var t=e(i.currentTarget),n=t.find("i"),a=t.parents(".modal");n.removeClass().addClass("piplin piplin-load piplin-spin"),a.find("input").attr("disabled","disabled"),e("button.close",a).hide(),Piplin.Keys.get(e("#model_id").val()).destroy({wait:!0,success:function(i,t,s){a.modal("hide"),e(".callout-danger",a).hide(),n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled"),Piplin.toast(trans("keys.delete_success"))},error:function(){n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled")}})}),e("#key button.btn-save").on("click",function(i){var t=e(i.currentTarget),n=t.find("i"),a=t.parents(".modal");n.removeClass().addClass("piplin piplin-load piplin-spin"),a.find("input").attr("disabled","disabled"),e("button.close",a).hide();var s=e("#key_id").val();if(s)var l=Piplin.Keys.get(s);else var l=new Piplin.Key;l.save({name:e("#key_name").val(),private_key:e("#key_private_key").val()},{wait:!0,success:function(i,t,l){a.modal("hide"),e(".callout-danger",a).hide(),n.removeClass().addClass("piplin piplin-save"),e("button.close",a).show(),a.find("input").removeAttr("disabled");var r=trans("keys.edit_success");s||(Piplin.Keys.add(t),r=trans("keys.create_success")),Piplin.toast(r)},error:function(i,t,s){e(".callout-danger",a).show();var l=t.responseJSON;e(".has-error",a).removeClass("has-error"),e(".label-danger",a).remove(),e("form input, form textarea",a).each(function(i,t){t=e(t);var n=t.attr("name");if(void 0!==l[n]){var a=t.parent("div");a.addClass("has-error"),a.append(e("<span>").attr("class","label label-danger").text(l[n]))}}),n.removeClass().addClass("piplin piplin-save"),e("button.close",a).show(),a.find("input").removeAttr("disabled")}})}),Piplin.Key=Backbone.Model.extend({urlRoot:"/admin/keys"});var i=Backbone.Collection.extend({model:Piplin.Key,comparator:function(e,i){return e.get("name")>i.get("name")?-1:e.get("name")<i.get("name")?1:0}});Piplin.Keys=new i,Piplin.KeysTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#key_list tbody"),e("#no_keys").show(),e("#key_list").hide(),this.listenTo(Piplin.Keys,"add",this.addOne),this.listenTo(Piplin.Keys,"reset",this.addAll),this.listenTo(Piplin.Keys,"remove",this.addAll),this.listenTo(Piplin.Keys,"all",this.render),Piplin.listener.on("key:"+Piplin.events.MODEL_CHANGED,function(e){var i=Piplin.Keys.get(parseInt(e.model.id));i&&i.set(e.model)}),Piplin.listener.on("key:"+Piplin.events.MODEL_CREATED,function(e){Piplin.Keys.add(e.model)}),Piplin.listener.on("key:"+Piplin.events.MODEL_TRASHED,function(e){var i=Piplin.Keys.get(parseInt(e.model.id));i&&Piplin.Keys.remove(i)})},render:function(){Piplin.Keys.length?(e("#no_keys").hide(),e("#key_list").show()):(e("#no_keys").show(),e("#key_list").hide())},addOne:function(i){var t=new Piplin.KeyView({model:i});this.$list.append(t.render().el),Piplin.Keys.length<2?e(".drag-handle",this.$list).hide():e(".drag-handle",this.$list).show()},addAll:function(){this.$list.html(""),Piplin.Keys.each(this.addOne,this)}}),Piplin.KeyView=Backbone.View.extend({tagName:"tr",events:{"click .btn-show":"show","click .btn-edit":"edit","click .btn-delete":"trash"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#key-template").html())},render:function(){var e=this.model.toJSON();return this.$el.html(this.template(e)),this},edit:function(){e("#key_id").val(this.model.id),e("#key_name").val(this.model.get("name")),e("#key_private_key").val(this.model.get("private_key"))},show:function(){var i=this.model.toJSON();e("#key_log pre").html(i.public_key)},trash:function(){var i=e("#model_id");i.val(this.model.id),i.parents(".modal").removeClass().addClass("modal fade key-trash")}})}(jQuery),function(e){e("#cabinet_list table").sortable({containerSelector:"table",itemPath:"> tbody",itemSelector:"tr",placeholder:'<tr class="placeholder"/>',delay:500,onDrop:function(i,t,n){n(i,t);var a=[];e("tbody tr td:first-child",t.el[0]).each(function(i,t){a.push(e(t).data("cabinet-id"))}),e.ajax({url:"/admin/cabinets/reorder",method:"POST",data:{cabinets:a}})}}),e("#cabinet").on("show.bs.modal",function(i){var t=e(i.relatedTarget),n=e(this),a=trans("cabinets.create");e(".btn-danger",n).hide(),e(".callout-danger",n).hide(),e(".has-error",n).removeClass("has-error"),e(".label-danger",n).remove(),t.hasClass("btn-edit")?(a=trans("cabinets.edit"),e(".btn-danger",n).show()):(e("#cabinet_id").val(""),e("#cabinet_name").val(""),e("#cabinet_description").val("")),n.find(".modal-title span").text(a)}),e("body").delegate(".cabinet-trash button.btn-delete","click",function(i){var t=e(i.currentTarget),n=t.find("i"),a=t.parents(".modal");n.removeClass().addClass("piplin piplin-load piplin-spin"),a.find("input").attr("disabled","disabled"),e("button.close",a).hide(),Piplin.Cabinets.get(e("#model_id").val()).destroy({wait:!0,success:function(i,t,s){a.modal("hide"),e(".callout-danger",a).hide(),n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled"),Piplin.toast(trans("cabinets.delete_success"))},error:function(){n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled")}})}),e("#cabinet button.btn-save").on("click",function(i){var t=e(i.currentTarget),n=t.find("i"),a=t.parents(".modal");n.removeClass().addClass("piplin piplin-load piplin-spin"),a.find("input").attr("disabled","disabled"),e("button.close",a).hide();var s=e("#cabinet_id").val();if(s)var l=Piplin.Cabinets.get(s);else var l=new Piplin.Cabinet;l.save({name:e("#cabinet_name").val(),description:e("#cabinet_description").val()},{wait:!0,success:function(i,t,l){a.modal("hide"),e(".callout-danger",a).hide(),n.removeClass().addClass("piplin piplin-save"),e("button.close",a).show(),a.find("input").removeAttr("disabled");var r=trans("cabinets.edit_success");s||(Piplin.Cabinets.add(t),r=trans("cabinets.create_success")),Piplin.toast(r)},error:function(i,t,s){e(".callout-danger",a).show();var l=t.responseJSON;e(".has-error",a).removeClass("has-error"),e(".label-danger",a).remove(),e("form input",a).each(function(i,t){t=e(t);var n=t.attr("name");if(void 0!==l[n]){var a=t.parent("div");a.addClass("has-error"),a.append(e("<span>").attr("class","label label-danger").text(l[n]))}}),n.removeClass().addClass("piplin piplin-save"),e("button.close",a).show(),a.find("input").removeAttr("disabled")}})}),Piplin.Cabinet=Backbone.Model.extend({urlRoot:"/admin/cabinets",initialize:function(){}});var i=Backbone.Collection.extend({model:Piplin.Cabinet});Piplin.Cabinets=new i,Piplin.CabinetsTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#cabinet_list tbody"),e("#cabinet_list").hide(),e("#no_cabinets").show(),this.listenTo(Piplin.Cabinets,"add",this.addOne),this.listenTo(Piplin.Cabinets,"reset",this.addAll),this.listenTo(Piplin.Cabinets,"remove",this.addAll),this.listenTo(Piplin.Cabinets,"all",this.render),Piplin.listener.on("cabinet:"+Piplin.events.MODEL_CHANGED,function(i){e("#cabinet_"+i.model.id).html(i.model.name);var t=Piplin.Cabinets.get(parseInt(i.model.id));t&&t.set(i.model)}),Piplin.listener.on("cabinet:"+Piplin.events.MODEL_CREATED,function(e){Piplin.Cabinets.add(e.model)}),Piplin.listener.on("cabinet:"+Piplin.events.MODEL_TRASHED,function(i){var t=Piplin.Cabinets.get(parseInt(i.model.id));t&&Piplin.Cabinets.remove(t),e("#cabinet_"+i.model.id).parent("li").remove(),parseInt(i.model.id)===parseInt(Piplin.cabinet_id)&&(window.location.href="/")})},render:function(){Piplin.Cabinets.length?(e("#no_cabinets").hide(),e("#cabinet_list").show()):(e("#no_cabinets").show(),e("#cabinet_list").hide())},addOne:function(i){var t=new Piplin.CabinetView({model:i});this.$list.append(t.render().el),e(".server-names",this.$list).tooltip()},addAll:function(){this.$list.html(""),Piplin.Cabinets.each(this.addOne,this)}}),Piplin.CabinetView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"edit","click .btn-delete":"trash"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#cabinet-template").html())},render:function(){var e=this.model.toJSON();return this.$el.html(this.template(e)),this},edit:function(){e("#cabinet_id").val(this.model.id),e("#cabinet_name").val(this.model.get("name")),e("#cabinet_description").val(this.model.get("description"))},trash:function(){var i=e("#model_id");i.val(this.model.id),i.parents(".modal").removeClass().addClass("modal fade cabinet-trash")}})}(jQuery),function(e){e("#user").on("show.bs.modal",function(i){var t=e(i.relatedTarget),n=e(this),a=trans("users.create");e(".btn-danger",n).hide(),e(".callout-danger",n).hide(),e(".existing-only",n).hide(),e(".new-only",n).hide(),e(".has-error",n).removeClass("has-error"),e(".label-danger",n).remove(),t.hasClass("btn-edit")?(a=trans("users.edit"),e(".btn-danger",n).show(),e(".existing-only",n).show()):(e("#user_id").val(""),e("#user_name").val(""),e("#user_level").select2(Piplin.select2_options),e("#user_nickname").val(""),e("#user_email").val(""),e("#user_password").val(""),e("#user_password_confirmation").val(""),e(".new-only",n).show()),n.find(".modal-title span").text(a)}),e("body").delegate(".user-trash button.btn-delete","click",function(i){var t=e(i.currentTarget),n=t.find("i"),a=t.parents(".modal");n.removeClass().addClass("piplin piplin-load piplin-spin"),a.find("input").attr("disabled","disabled"),e("button.close",a).hide(),Piplin.Users.get(e("#model_id").val()).destroy({wait:!0,success:function(i,t,s){a.modal("hide"),e(".callout-danger",a).hide(),n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled"),Piplin.toast(trans("users.delete_success"))},error:function(){n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled")}})}),e("#user button.btn-save").on("click",function(i){var t=e(i.currentTarget),n=t.find("i"),a=t.parents(".modal");n.removeClass().addClass("piplin piplin-load piplin-spin"),a.find("input").attr("disabled","disabled"),e("button.close",a).hide();var s=e("#user_id").val();if(s)var l=Piplin.Users.get(s);else var l=new Piplin.User;l.save({name:e("#user_name").val(),level:e("#user_level").val(),nickname:e("#user_nickname").val(),email:e("#user_email").val(),password:e("#user_password").val(),password_confirmation:e("#user_password_confirmation").val()},{wait:!0,success:function(i,t,l){a.modal("hide"),e(".callout-danger",a).hide(),n.removeClass().addClass("piplin piplin-save"),e("button.close",a).show(),a.find("input").removeAttr("disabled");var r=trans("users.edit_success");s||(Piplin.Users.add(t),r=trans("users.create_success")),Piplin.toast(r)},error:function(i,t,s){e(".callout-danger",a).show();var l=t.responseJSON;e(".has-error",a).removeClass("has-error"),e(".label-danger",a).remove(),e("form input",a).each(function(i,t){t=e(t);var n=t.attr("name");if(void 0!==l[n]){var a=t.parent("div");a.addClass("has-error"),a.append(e("<span>").attr("class","label label-danger").text(l[n]))}}),n.removeClass().addClass("piplin piplin-save"),e("button.close",a).show(),a.find("input").removeAttr("disabled")}})}),Piplin.User=Backbone.Model.extend({urlRoot:"/admin/users",initialize:function(){}});var i=Backbone.Collection.extend({model:Piplin.User});Piplin.Users=new i,Piplin.UsersTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#user_list tbody"),this.listenTo(Piplin.Users,"add",this.addOne),this.listenTo(Piplin.Users,"reset",this.addAll),this.listenTo(Piplin.Users,"remove",this.addAll),this.listenTo(Piplin.Users,"all",this.render),Piplin.listener.on("user:"+Piplin.events.MODEL_CHANGED,function(e){var i=Piplin.Users.get(parseInt(e.model.id));i&&i.set(e.model)}),Piplin.listener.on("user:"+Piplin.events.MODEL_CREATED,function(e){Piplin.Users.add(e.model)}),Piplin.listener.on("user:"+Piplin.events.MODEL_TRASHED,function(e){var i=Piplin.Users.get(parseInt(e.model.id));i&&Piplin.Users.remove(i)})},addOne:function(e){var i=new Piplin.UserView({model:e});this.$list.append(i.render().el)},addAll:function(){this.$list.html(""),Piplin.Users.each(this.addOne,this)}}),Piplin.UserView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"edit","click .btn-delete":"trash"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#user-template").html())},render:function(){var e=this.model.toJSON();return e.created=moment(e.created_at).format("YYYY-MM-DD HH:mm:ss"),this.$el.html(this.template(e)),this},edit:function(){e("#user_id").val(this.model.id),e("#user_name").val(this.model.get("name")),e("#user_level").select2(Piplin.select2_options).val(this.model.get("level")).trigger("change"),e("#user_nickname").val(this.model.get("nickname")),e("#user_email").val(this.model.get("email"))},trash:function(){var i=e("#model_id");i.val(this.model.id),i.parents(".modal").removeClass().addClass("modal fade user-trash")}})}(jQuery),function(e){e(".command-list table").sortable({containerSelector:"table",itemPath:"> tbody",itemSelector:"tr",placeholder:'<tr class="placeholder"/>',delay:500,onDrop:function(i,t,n){n(i,t);var a=[];e("tbody tr td:first-child",t.el[0]).each(function(i,t){a.push(e(t).data("command-id"))}),e.ajax({url:"/commands/reorder",method:"POST",data:{commands:a}})}});var i;e("#command").on("hidden.bs.modal",function(e){i.destroy()}),e("#command").on("show.bs.modal",function(t){var n=e(t.relatedTarget),a=e(this),s=trans("commands.create");i=ace.edit("command_script"),i.getSession().setMode("ace/mode/sh"),e(".btn-danger",a).hide(),e(".callout-danger",a).hide(),e(".has-error",a).removeClass("has-error"),e(".label-danger",a).remove(),n.hasClass("btn-edit")?(s=trans("commands.edit"),e(".btn-danger",a).show()):(e("#command_id").val(""),e("#command_step").val(n.data("step")),e("#command_name").val(""),i.setValue(""),i.gotoLine(1),e("#command_user").val(""),e("#command_optional").prop("checked",!1),e("#command_default_on").prop("checked",!1),e("#command_default_on_row").addClass("hide"),e(".command-environment").prop("checked",!0),e(".command-pattern").prop("checked",!0)),a.find(".modal-title span").text(s)}),e("body").delegate(".command-trash button.btn-delete","click",function(i){var t=e(i.currentTarget),n=t.find("i"),a=t.parents(".modal");n.removeClass().addClass("piplin piplin-load piplin-spin"),a.find("input").attr("disabled","disabled"),e("button.close",a).hide(),Piplin.Commands.get(e("#model_id").val()).destroy({wait:!0,success:function(i,t,s){a.modal("hide"),e(".callout-danger",a).hide(),n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled"),Piplin.toast(trans("commands.delete_success"))},error:function(){n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled")}})}),e("#command_optional").on("change",function(i){
e("#command_default_on_row").addClass("hide"),!0===e(this).is(":checked")&&e("#command_default_on_row").removeClass("hide")}),e("#command button.btn-save").off("click").on("click",function(t){var n=e(t.currentTarget),a=n.find("i"),s=n.parents(".modal");a.removeClass().addClass("piplin piplin-load piplin-spin"),s.find(":input").attr("disabled","disabled"),e("button.close",s).hide();var l=e("#command_id").val();if(l)var r=Piplin.Commands.get(l);else var r=new Piplin.Command;var o=[];e(".command-environment:checked").each(function(){o.push(e(this).val())});var d=[];e(".command-pattern:checked").each(function(){d.push(e(this).val())}),r.save({name:e("#command_name").val(),script:i.getValue(),user:e("#command_user").val(),step:e("#command_step").val(),targetable_type:e('input[name="targetable_type"]').val(),targetable_id:e('input[name="targetable_id"]').val(),environments:o,patterns:d,optional:e("#command_optional").is(":checked"),default_on:e("#command_default_on").is(":checked")},{wait:!0,success:function(t,n,r){s.modal("hide"),e(".callout-danger",s).hide(),a.removeClass().addClass("piplin piplin-save"),e("button.close",s).show(),s.find(":input").removeAttr("disabled");var o=trans("commands.edit_success");l||(Piplin.Commands.add(n),o=trans("commands.create_success")),i.setValue(""),i.gotoLine(1),Piplin.toast(o)},error:function(i,t,n){e(".callout-danger",s).show();var l=t.responseJSON;e(".has-error",s).removeClass("has-error"),e(".label-danger",s).remove(),e("form input",s).each(function(i,t){t=e(t);var n=t.attr("name");if(void 0!==l[n]){var a=t.parent("div");a.addClass("has-error"),a.append(e("<span>").attr("class","label label-danger").text(l[n]))}}),a.removeClass().addClass("piplin piplin-save"),e("button.close",s).show(),s.find(":input").removeAttr("disabled")}})}),Piplin.Command=Backbone.Model.extend({urlRoot:"/commands",defaults:function(){return{order:Piplin.Commands.nextOrder()}},isAfter:function(){return parseInt(this.get("step"))%3==0}});var t=Backbone.Collection.extend({model:Piplin.Command,comparator:"order",nextOrder:function(){return this.length?this.last().get("order")+1:1}});Piplin.Commands=new t,Piplin.CommandsTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$beforeList=e("#commands-before .command-list tbody"),this.$afterList=e("#commands-after .command-list tbody"),e(".no-commands").show(),e(".command-list").hide(),this.listenTo(Piplin.Commands,"add",this.addOne),this.listenTo(Piplin.Commands,"reset",this.addAll),this.listenTo(Piplin.Commands,"remove",this.addAll),this.listenTo(Piplin.Commands,"all",this.render),Piplin.listener.on("command:"+Piplin.events.MODEL_CHANGED,function(e){var i=Piplin.Commands.get(parseInt(e.model.id));i&&i.set(e.model)}),Piplin.listener.on("command:"+Piplin.events.MODEL_CREATED,function(i){var t=e('input[name="targetable_type"]').val(),n=e('input[name="targetable_id"]').val();t==i.model.targetable_type&&parseInt(i.model.targetable_id)===parseInt(n)&&(parseInt(i.model.step)+1!==parseInt(Piplin.command_action)&&parseInt(i.model.step)-1!==parseInt(Piplin.command_action)||Piplin.Commands.add(i.model))}),Piplin.listener.on("command:"+Piplin.events.MODEL_TRASHED,function(e){var i=Piplin.Commands.get(parseInt(e.model.id));i&&Piplin.Commands.remove(i)})},render:function(){void 0!==Piplin.Commands.find(function(e){return!e.isAfter()})?(e("#commands-before .no-commands").hide(),e("#commands-before .command-list").show()):(e("#commands-before .no-commands").show(),e("#commands-before .command-list").hide()),void 0!==Piplin.Commands.find(function(e){return e.isAfter()})?(e("#commands-after .no-commands").hide(),e("#commands-after .command-list").show()):(e("#commands-after .no-commands").show(),e("#commands-after .command-list").hide())},addOne:function(i){var t=new Piplin.CommandView({model:i});i.isAfter()?(this.$afterList.append(t.render().el),e("tr",this.$afterList).length<2?e(".drag-handle",this.$afterList).hide():e(".drag-handle",this.$afterList).show()):(this.$beforeList.append(t.render().el),e("tr",this.$beforeList).length<2?e(".drag-handle",this.$beforeList).hide():e(".drag-handle",this.$beforeList).show())},addAll:function(){this.$beforeList.html(""),this.$afterList.html(""),Piplin.Commands.each(this.addOne,this)}}),Piplin.CommandView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"edit","click .btn-delete":"trash"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#command-template").html())},render:function(){var e=this.model.toJSON();return this.$el.html(this.template(e)),this},edit:function(){e("#command_id").val(this.model.id),e("#command_step").val(this.model.get("step")),e("#command_name").val(this.model.get("name")),e("#command_script").text(this.model.get("script")),e("#command_user").val(this.model.get("user")),e("#command_optional").prop("checked",!0===this.model.get("optional")),e("#command_default_on").prop("checked",!0===this.model.get("default_on")),e("#command_default_on_row").addClass("hide"),!0===this.model.get("optional")&&e("#command_default_on_row").removeClass("hide"),e(".command-environment").prop("checked",!1),e(this.model.get("environments")).each(function(i,t){e("#command_environment_"+t.id).prop("checked",!0)}),e(".command-pattern").prop("checked",!1),e(this.model.get("patterns")).each(function(i,t){e("#command_pattern_"+t.id).prop("checked",!0)})},trash:function(){var i=e("#model_id");i.val(this.model.id),i.parents(".modal").removeClass().addClass("modal fade command-trash")}})}(jQuery),function(e){var i,t;e("#configfile, #view-configfile, #sync-configfile").on("hidden.bs.modal",function(e){i.destroy()}),e("#view-configfile").on("show.bs.modal",function(e){i=ace.edit("preview-content"),i.setReadOnly(!0),i.getSession().setUseWrapMode(!0);var n=t.substr(t.lastIndexOf(".")+1).toLowerCase();"php"===n||"ini"===n?i.getSession().setMode("ace/mode/"+n):"yml"===n&&i.getSession().setMode("ace/mode/yaml")}),e("#configfile").on("show.bs.modal",function(t){var n=e(t.relatedTarget),a=e(this),s=trans("configFiles.create");i=ace.edit("content");var l=e("#path").val(),r=l.substr(l.lastIndexOf(".")+1).toLowerCase();"php"===r||"ini"===r?i.getSession().setMode("ace/mode/"+r):"yml"===r&&i.getSession().setMode("ace/mode/yaml"),e(".btn-danger",a).hide(),e(".callout-danger",a).hide(),e(".has-error",a).removeClass("has-error"),e(".label-danger",a).remove(),n.hasClass("btn-edit")?(s=trans("configFiles.edit"),e(".btn-danger",a).show()):(e("#file_id").val(""),e("#name").val(""),e("#path").val(""),e(".configfile-environment").prop("checked",!0),i.setValue(""),i.gotoLine(1)),a.find(".modal-title span").text(s)}),e("body").delegate(".configfile-trash button.btn-delete","click",function(i){var t=e(i.currentTarget),n=t.find("i"),a=t.parents(".modal");n.removeClass().addClass("piplin piplin-load piplin-spin"),a.find("input").attr("disabled","disabled"),e("button.close",a).hide(),Piplin.ConfigFiles.get(e("#model_id").val()).destroy({wait:!0,success:function(i,t,s){a.modal("hide"),e(".callout-danger",a).hide(),n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled"),Piplin.toast(trans("configFiles.delete_success"))},error:function(){n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled")}})}),e("#configfile button.btn-save").on("click",function(t){var n=e(t.currentTarget),a=n.find("i"),s=n.parents(".modal");a.removeClass().addClass("piplin piplin-load piplin-spin"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var l=e("#config_file_id").val();if(l)var r=Piplin.ConfigFiles.get(l);else var r=new Piplin.ConfigFile;var o=[];e(".configfile-environment:checked").each(function(){o.push(e(this).val())}),r.save({name:e("#name").val(),path:e("#path").val(),targetable_type:e('input[name="targetable_type"]').val(),targetable_id:e('input[name="targetable_id"]').val(),environments:o,content:i.getValue()},{wait:!0,success:function(t,n,r){s.modal("hide"),e(".callout-danger",s).hide(),a.removeClass().addClass("piplin piplin-save"),e("button.close",s).show(),s.find("input").removeAttr("disabled");var o=trans("configFiles.edit_success");l||(Piplin.ConfigFiles.add(n),trans("configFiles.create_success")),i.setValue(""),i.gotoLine(1),Piplin.toast(o)},error:function(i,t,n){e(".callout-danger",s).show();var l=t.responseJSON;e(".has-error",s).removeClass("has-error"),e(".label-danger",s).remove(),e("form input",s).each(function(i,t){t=e(t);var n=t.attr("name");if(void 0!==l[n]){var a=t.parent("div");a.addClass("has-error"),a.append(e("<span>").attr("class","label label-danger").text(l[n]))}}),a.removeClass().addClass("piplin piplin-save"),e("button.close",s).show(),s.find("input").removeAttr("disabled")}})}),e("#sync-configfile button.btn-save").on("click",function(t){var n=e(t.currentTarget),a=n.find("i"),s=n.parents(".modal");a.removeClass().addClass("piplin piplin-load piplin-spin"),s.find("input").attr("disabled","disabled"),e("button.close",s).hide();var l=e("#sync-configfile_id").val();if(l)var r=Piplin.ConfigFiles.get(l);else var r=new Piplin.ConfigFile;r.set({status:3});var o=[];e(".sync-environment:checked").each(function(){o.push(e(this).val())});var d=i.getValue();e.ajax({type:"POST",url:"/config-files/"+l+"/sync",data:{post_commands:d,environment_ids:o}}).done(function(i){s.modal("hide"),e(".callout-danger",s).hide(),a.removeClass().addClass("piplin piplin-save"),e("button.close",s).show();var t=trans("configFiles.sync_success");Piplin.toast(t)}),console.log(d)}),Piplin.ConfigFile=Backbone.Model.extend({urlRoot:"/config-files"});var n=Backbone.Collection.extend({model:Piplin.ConfigFile});Piplin.ConfigFiles=new n,Piplin.ConfigFilesTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#configfile_list tbody"),e("#no_configfiles").show(),e("#configfile_list").hide(),this.listenTo(Piplin.ConfigFiles,"add",this.addOne),this.listenTo(Piplin.ConfigFiles,"reset",this.addAll),this.listenTo(Piplin.ConfigFiles,"remove",this.addAll),this.listenTo(Piplin.ConfigFiles,"all",this.render),Piplin.listener.on("configfile:"+Piplin.events.MODEL_CHANGED,function(e){var i=Piplin.ConfigFiles.get(parseInt(e.model.id));i&&i.set(e.model)}),Piplin.listener.on("configfile:"+Piplin.events.MODEL_CREATED,function(i){var t=e('input[name="targetable_type"]').val(),n=e('input[name="targetable_id"]').val();t==i.model.targetable_type&&parseInt(i.model.targetable_id)===parseInt(n)&&Piplin.ConfigFiles.add(i.model)}),Piplin.listener.on("configfile:"+Piplin.events.MODEL_TRASHED,function(e){var i=Piplin.ConfigFiles.get(parseInt(e.model.id));i&&Piplin.ConfigFiles.remove(i)})},render:function(){Piplin.ConfigFiles.length?(e("#no_configfiles").hide(),e("#configfile_list").show()):(e("#no_configfiles").show(),e("#configfile_list").hide())},addOne:function(e){var i=new Piplin.ConfigFileView({model:e});this.$list.append(i.render().el)},addAll:function(){this.$list.html(""),Piplin.ConfigFiles.each(this.addOne,this)}}),Piplin.ConfigFileView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"edit","click .btn-delete":"trash","click .btn-view":"view","click .btn-sync":"sync","click .btn-show":"showLog"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#configfiles-template").html())},render:function(){var e=this.model.toJSON();return e.status_css="orange",e.icon_css="circle",e.status=trans("configFiles.unsynced"),0===parseInt(this.model.get("status"))?(e.status_css="success",e.status=trans("configFiles.successful")):3===parseInt(this.model.get("status"))?(e.status_css="purple",e.icon_css="load piplin-spin",e.status=trans("configFiles.syncing")):2===parseInt(this.model.get("status"))&&(e.status_css="danger",e.status=trans("configFiles.failed")),console.log(e),this.$el.html(this.template(e)),this},view:function(){t=this.model.get("path"),e("#preview-content").text(this.model.get("content"))},showLog:function(){var i=this.model.toJSON();e("#log pre").html(i.output)},sync:function(){e("#sync-configfile_id").val(this.model.id),i=ace.edit("command_script"),i.setValue(""),i.gotoLine(1),e(".sync-environment").prop("checked",!1).prop("disabled",!0).parent().attr("class","text-gray"),e(this.model.get("environments")).each(function(i,t){e("#sync_environment_"+t.id).prop("checked",!0).prop("disabled",!1).parent().removeClass("text-gray")})},edit:function(){e("#config_file_id").val(this.model.id),e("#name").val(this.model.get("name")),e("#path").val(this.model.get("path")),e("#content").text(this.model.get("content")),e(".configfile-environment").prop("checked",!1),e(this.model.get("environments")).each(function(i,t){e("#configfile_environment_"+t.id).prop("checked",!0)})},trash:function(){var i=e("#model_id");i.val(this.model.id),i.parents(".modal").removeClass().addClass("modal fade configfile-trash")}})}(jQuery),function(e){e("#environment_list table").sortable({containerSelector:"table",itemPath:"> tbody",itemSelector:"tr",placeholder:'<tr class="placeholder"/>',delay:500,onDrop:function(i,t,n){n(i,t);var a=[];e("tbody tr td:first-child",t.el[0]).each(function(i,t){a.push(e(t).data("environment-id"))}),e.ajax({url:"/environments/reorder",method:"POST",data:{environments:a}})}}),e("#environment").on("show.bs.modal",function(i){var t=e(i.relatedTarget),n=e(this),a=trans("environments.create");e(".btn-danger",n).hide(),e(".callout-danger",n).hide(),e(".has-error",n).removeClass("has-error"),e(".label-danger",n).remove(),e("#add-environment-command",n).hide(),t.hasClass("btn-edit")?(a=trans("environments.edit"),e(".btn-danger",n).show()):(e("#environment_id").val(""),e("#environment_name").val(""),e("#environment_description").val(""),e("#environment_default_on").prop("checked",!0),e("#add-environment-command",n).show()),n.find(".modal-title span").text(a)}),e("body").delegate(".environment-trash button.btn-delete","click",function(i){var t=e(i.currentTarget),n=t.find("i"),a=t.parents(".modal");n.removeClass().addClass("piplin piplin-load piplin-spin"),a.find("input").attr("disabled","disabled"),e("button.close",a).hide(),Piplin.Environments.get(e("#model_id").val()).destroy({wait:!0,success:function(i,t,s){a.modal("hide"),e(".callout-danger",a).hide(),n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled"),Piplin.toast(trans("environments.delete_success"))},error:function(){n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled")}})}),e("#environment button.btn-save").on("click",function(i){var t=e(i.currentTarget),n=t.find("i"),a=t.parents(".modal");n.removeClass().addClass("piplin piplin-load piplin-spin"),a.find("input").attr("disabled","disabled"),e("button.close",a).hide();var s=e("#environment_id").val();if(s)var l=Piplin.Environments.get(s);else var l=new Piplin.Environment;l.save({name:e("#environment_name").val(),description:e("#environment_description").val(),default_on:e("#environment_default_on").is(":checked"),targetable_type:e('input[name="targetable_type"]').val(),targetable_id:e('input[name="targetable_id"]').val(),add_commands:e("#environment_commands").is(":checked")},{wait:!0,success:function(i,t,l){a.modal("hide"),e(".callout-danger",a).hide(),n.removeClass().addClass("piplin piplin-save"),e("button.close",a).show(),a.find("input").removeAttr("disabled");var r=trans("environments.edit_success");s||(Piplin.Environments.add(t),r=trans("environments.create_success")),Piplin.toast(r)},error:function(i,t,s){e(".callout-danger",a).show();var l=t.responseJSON;e(".has-error",a).removeClass("has-error"),e(".label-danger",a).remove(),e("form input",a).each(function(i,t){t=e(t);var n=t.attr("name");if(void 0!==l[n]){var a=t.parent("div");a.addClass("has-error"),a.append(e("<span>").attr("class","label label-danger").text(l[n]))}}),n.removeClass().addClass("piplin piplin-save"),e("button.close",a).show(),a.find("input").removeAttr("disabled")}})}),Piplin.Environment=Backbone.Model.extend({urlRoot:"/environments",initialize:function(){}});var i=Backbone.Collection.extend({model:Piplin.Environment});Piplin.Environments=new i,Piplin.EnvironmentsTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#environment_list tbody"),e("#no_environments").show(),e("#environment_list").hide(),this.listenTo(Piplin.Environments,"add",this.addOne),this.listenTo(Piplin.Environments,"reset",this.addAll),this.listenTo(Piplin.Environments,"remove",this.addAll),this.listenTo(Piplin.Environments,"all",this.render),Piplin.listener.on("environment:"+Piplin.events.MODEL_CHANGED,function(i){e("#environment_"+i.model.id).html(i.model.name);var t=Piplin.Environments.get(parseInt(i.model.id));t&&t.set(i.model)}),Piplin.listener.on("environment:"+Piplin.events.MODEL_CREATED,function(i){var t=e('input[name="targetable_type"]').val(),n=e('input[name="targetable_id"]').val();t==i.model.targetable_type&&parseInt(i.model.targetable_id)===parseInt(n)&&Piplin.Environments.add(i.model)}),Piplin.listener.on("environment:"+Piplin.events.MODEL_TRASHED,function(e){var i=Piplin.Environments.get(parseInt(e.model.id));i&&Piplin.Environments.remove(i)})},render:function(){Piplin.Environments.length?(e("#no_environments").hide(),e("#environment_list").show()):(e("#no_environments").show(),e("#environment_list").hide())},addOne:function(i){var t=new Piplin.EnvironmentView({model:i});this.$list.append(t.render().el),e(".server-names",this.$list).tooltip(),Piplin.Environments.length<2?e(".drag-handle",this.$list).hide():e(".drag-handle",this.$list).show()},addAll:function(){this.$list.html(""),Piplin.Environments.each(this.addOne,this)}}),Piplin.EnvironmentView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"edit","click .btn-delete":"trash"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#environment-template").html())},render:function(){var i=this.model.toJSON(),t=Piplin.formatProjectStatus(parseInt(this.model.get("status")));return i=e.extend(i,t),i.last_run=null!=i.last_run?moment(i.last_run).fromNow():trans("app.never"),this.$el.html(this.template(i)),this},edit:function(){e("#environment_id").val(this.model.id),e("#environment_name").val(this.model.get("name")),e("#environment_description").val(this.model.get("description")),e("#environment_default_on").prop("checked",!0===this.model.get("default_on"))},trash:function(){var i=e("#model_id");i.val(this.model.id),i.parents(".modal").removeClass().addClass("modal fade environment-trash")}})}(jQuery),function(e){e("#sharedfile").on("show.bs.modal",function(i){var t=e(i.relatedTarget),n=e(this),a=trans("sharedFiles.create");e(".btn-danger",n).hide(),e(".callout-danger",n).hide(),e(".has-error",n).removeClass("has-error"),e(".label-danger",n).remove(),t.hasClass("btn-edit")?(a=trans("sharedFiles.edit"),e(".btn-danger",n).show()):(e("#sharedfile_id").val(""),e("#name").val(""),e("#file").val("")),n.find(".modal-title span").text(a)}),e("body").delegate(".sharedfile-trash button.btn-delete","click",function(i){var t=e(i.currentTarget),n=t.find("i"),a=t.parents(".modal");n.removeClass().addClass("piplin piplin-load piplin-spin"),a.find("input").attr("disabled","disabled"),e("button.close",a).hide(),Piplin.SharedFiles.get(e("#model_id").val()).destroy({wait:!0,success:function(i,t,s){a.modal("hide"),e(".callout-danger",a).hide(),n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled"),Piplin.toast(trans("sharedFiles.delete_success"))},error:function(){n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled")}})}),e("#sharedfile button.btn-save").on("click",function(i){var t=e(i.currentTarget),n=t.find("i"),a=t.parents(".modal");n.removeClass().addClass("piplin piplin-load piplin-spin"),a.find("input").attr("disabled","disabled"),e("button.close",a).hide();var s=e("#sharedfile_id").val();if(s)var l=Piplin.SharedFiles.get(s);else var l=new Piplin.SharedFile;l.save({name:e("#name").val(),file:e("#file").val(),targetable_type:e('input[name="targetable_type"]').val(),targetable_id:e('input[name="targetable_id"]').val()},{wait:!0,success:function(i,t,l){a.modal("hide"),e(".callout-danger",a).hide(),n.removeClass().addClass("piplin piplin-save"),e("button.close",a).show(),a.find("input").removeAttr("disabled");var r=trans("sharedFiles.edit_success");s||(Piplin.SharedFiles.add(t),trans("sharedFiles.create_success")),Piplin.toast(r)},error:function(i,t,s){e(".callout-danger",a).show();var l=t.responseJSON;e(".has-error",a).removeClass("has-error"),e(".label-danger",a).remove(),e("form input",a).each(function(i,t){t=e(t);var n=t.attr("name");if(void 0!==l[n]){var a=t.parent("div");a.addClass("has-error"),a.append(e("<span>").attr("class","label label-danger").text(l[n]))}}),n.removeClass().addClass("piplin piplin-save"),e("button.close",a).show(),a.find("input").removeAttr("disabled")}})}),Piplin.SharedFile=Backbone.Model.extend({urlRoot:"/shared-files"});var i=Backbone.Collection.extend({model:Piplin.SharedFile});Piplin.SharedFiles=new i,Piplin.SharedFilesTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#sharedfile_list tbody"),e("#no_sharedfiles").show(),e("#sharedfile_list").hide(),this.listenTo(Piplin.SharedFiles,"add",this.addOne),this.listenTo(Piplin.SharedFiles,"reset",this.addAll),this.listenTo(Piplin.SharedFiles,"remove",this.addAll),this.listenTo(Piplin.SharedFiles,"all",this.render),Piplin.listener.on("sharedfile:"+Piplin.events.MODEL_CHANGED,function(e){var i=Piplin.SharedFiles.get(parseInt(e.model.id));i&&i.set(e.model)}),Piplin.listener.on("sharedfile:"+Piplin.events.MODEL_CREATED,function(i){var t=e('input[name="targetable_type"]').val(),n=e('input[name="targetable_id"]').val();t==i.model.targetable_type&&parseInt(i.model.targetable_id)===parseInt(n)&&Piplin.SharedFiles.add(i.model)}),Piplin.listener.on("sharedfile:"+Piplin.events.MODEL_TRASHED,function(e){var i=Piplin.SharedFiles.get(parseInt(e.model.id));i&&Piplin.SharedFiles.remove(i)})},render:function(){Piplin.SharedFiles.length?(e("#no_sharedfiles").hide(),e("#sharedfile_list").show()):(e("#no_sharedfiles").show(),e("#sharedfile_list").hide())},addOne:function(e){var i=new Piplin.SharedFileView({model:e});this.$list.append(i.render().el)},addAll:function(){this.$list.html(""),Piplin.SharedFiles.each(this.addOne,this)}}),Piplin.SharedFileView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"edit","click .btn-delete":"trash"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#sharedfile-template").html())},render:function(){var e=this.model.toJSON();return this.$el.html(this.template(e)),this},edit:function(){e("#sharedfile_id").val(this.model.id),e("#name").val(this.model.get("name")),e("#file").val(this.model.get("file"))},trash:function(){var i=e("#model_id");i.val(this.model.id),i.parents(".modal").removeClass().addClass("modal fade sharedfile-trash")}})}(jQuery),function(e){e("#variable").on("show.bs.modal",function(i){var t=e(i.relatedTarget),n=e(this),a=trans("variables.create");e(".btn-danger",n).hide(),e(".callout-danger",n).hide(),e(".has-error",n).removeClass("has-error"),e(".label-danger",n).remove(),t.hasClass("btn-edit")?(a=trans("variables.edit"),e(".btn-danger",n).show()):(e("#variable_id").val(""),e("#variable_name").val(""),e("#variable_value").val("")),n.find(".modal-title span").text(a)}),e("body").delegate(".variable-trash button.btn-delete","click",function(i){var t=e(i.currentTarget),n=t.find("i"),a=t.parents(".modal");n.removeClass().addClass("piplin piplin-load piplin-spin"),a.find("input").attr("disabled","disabled"),e("button.close",a).hide(),Piplin.Variables.get(e("#model_id").val()).destroy({wait:!0,success:function(i,t,s){a.modal("hide"),e(".callout-danger",a).hide(),n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled"),Piplin.toast(trans("variables.delete_success"))},error:function(){n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled")}})}),e("#variable button.btn-save").on("click",function(i){var t=e(i.currentTarget),n=t.find("i"),a=t.parents(".modal");n.removeClass().addClass("piplin piplin-load piplin-spin"),a.find("input").attr("disabled","disabled"),e("button.close",a).hide();var s=e("#variable_id").val();if(s)var l=Piplin.Variables.get(s);else var l=new Piplin.Variable;l.save({name:e("#variable_name").val(),value:e("#variable_value").val(),targetable_type:e('input[name="targetable_type"]').val(),targetable_id:e('input[name="targetable_id"]').val()},{wait:!0,success:function(i,t,l){a.modal("hide"),e(".callout-danger",a).hide(),n.removeClass().addClass("piplin piplin-save"),e("button.close",a).show(),a.find("input").removeAttr("disabled");var r=trans("variables.edit_success");s||(Piplin.Variables.add(t),r=trans("variables.create_success")),Piplin.toast(r)},error:function(i,t,s){e(".callout-danger",a).show();var l=t.responseJSON;e(".has-error",a).removeClass("has-error"),e(".label-danger",a).remove(),e("form input",a).each(function(i,t){t=e(t);var n=t.attr("name");if(void 0!==l[n]){var a=t.parent("div");a.addClass("has-error"),a.append(e("<span>").attr("class","label label-danger").text(l[n]))}}),n.removeClass().addClass("piplin piplin-save"),e("button.close",a).show(),a.find("input").removeAttr("disabled")}})}),Piplin.Variable=Backbone.Model.extend({urlRoot:"/variables",initialize:function(){}});var i=Backbone.Collection.extend({model:Piplin.Variable});Piplin.Variables=new i,Piplin.VariablesTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#variable_list tbody"),e("#no_variables").show(),e("#variable_list").hide(),this.listenTo(Piplin.Variables,"add",this.addOne),this.listenTo(Piplin.Variables,"reset",this.addAll),this.listenTo(Piplin.Variables,"remove",this.addAll),this.listenTo(Piplin.Variables,"all",this.render),Piplin.listener.on("variable:"+Piplin.events.MODEL_CHANGED,function(i){e("#variable_"+i.model.id).html(i.model.name);var t=Piplin.Variables.get(parseInt(i.model.id));t&&t.set(i.model)}),Piplin.listener.on("variable:"+Piplin.events.MODEL_CREATED,function(i){var t=e('input[name="targetable_type"]').val(),n=e('input[name="targetable_id"]').val();t==i.model.targetable_type&&parseInt(i.model.targetable_id)===parseInt(n)&&Piplin.Variables.add(i.model)}),Piplin.listener.on("variable:"+Piplin.events.MODEL_TRASHED,function(e){var i=Piplin.Variables.get(parseInt(e.model.id));i&&Piplin.Variables.remove(i)})},render:function(){Piplin.Variables.length?(e("#no_variables").hide(),e("#variable_list").show()):(e("#no_variables").show(),e("#variable_list").hide())},addOne:function(e){var i=new Piplin.VariableView({model:e});this.$list.append(i.render().el)},addAll:function(){this.$list.html(""),Piplin.Variables.each(this.addOne,this)}}),Piplin.VariableView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"edit","click .btn-delete":"trash"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#variable-template").html())},render:function(){var e=this.model.toJSON();return this.$el.html(this.template(e)),this},edit:function(){e("#variable_id").val(this.model.id),e("#variable_name").val(this.model.get("name")),e("#variable_value").val(this.model.get("value"))},trash:function(){var i=e("#model_id");i.val(this.model.id),i.parents(".modal").removeClass().addClass("modal fade variable-trash")}})}(jQuery),function(e){e("#server_list table").sortable({containerSelector:"table",itemPath:"> tbody",itemSelector:"tr",placeholder:'<tr class="placeholder"/>',delay:500,onDrop:function(i,t,n){n(i,t);var a=[];e("tbody tr td:first-child",t.el[0]).each(function(i,t){a.push(e(t).data("server-id"))}),e.ajax({url:"/servers/reorder",method:"POST",data:{servers:a}})}}),e("#server").on("show.bs.modal",function(i){var t=e(i.relatedTarget),n=e(this),a=trans("servers.create");e(".btn-danger",n).hide(),e(".callout-danger",n).hide(),e(".has-error",n).removeClass("has-error"),e(".label-danger",n).remove(),t.hasClass("btn-edit")?(a=trans("servers.edit"),e(".btn-danger",n).show()):(e("#server_id").val(""),e("#server_name").val(""),e("#server_enabled").prop("checked",!0),e("#server_address").val(""),e("#server_port").val("22"),e("#server_user").val(""),e("#server_targetable_id").val(e("#server_targetable_id option:selected").val())),n.find(".modal-title span").text(a)}),e("body").delegate(".server-trash button.btn-delete","click",function(i){var t=e(i.currentTarget),n=t.find("i"),a=t.parents(".modal");n.removeClass().addClass("piplin piplin-load piplin-spin"),a.find("input").attr("disabled","disabled"),e("button.close",a).hide(),Piplin.Servers.get(e("#model_id").val()).destroy({wait:!0,success:function(i,t,s){a.modal("hide"),e(".callout-danger",a).hide(),n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled"),Piplin.toast(trans("servers.delete_success"))},error:function(){n.removeClass().addClass("piplin piplin-delete"),e("button.close",a).show(),a.find("input").removeAttr("disabled")}})}),e("#server button.btn-save").on("click",function(i){var t=e(i.currentTarget),n=t.find("i"),a=t.parents(".modal");n.removeClass().addClass("piplin piplin-load piplin-spin"),a.find("input").attr("disabled","disabled"),e("button.close",a).hide();var s=e("#server_id").val();if(s)var l=Piplin.Servers.get(s);else var l=new Piplin.Server;l.save({name:e("#server_name").val(),ip_address:e("#server_address").val(),enabled:e("#server_enabled").is(":checked"),port:e("#server_port").val(),user:e("#server_user").val(),targetable_type:e('input[name="targetable_type"]').val(),targetable_id:parseInt(e("#server_targetable_id").val())},{wait:!0,success:function(i,t,l){a.modal("hide"),e(".callout-danger",a).hide(),n.removeClass().addClass("piplin piplin-save"),e("button.close",a).show(),a.find("input").removeAttr("disabled");var r=trans("servers.edit_success");s||(Piplin.Servers.add(t),r=trans("servers.create_success")),Piplin.toast(r)},error:function(i,t,s){e(".callout-danger",a).show();var l=t.responseJSON;e(".has-error",a).removeClass("has-error"),e(".label-danger",a).remove(),e("form input",a).each(function(i,t){t=e(t);var n=t.attr("name");if(void 0!==l[n]){var a=t.parent("div");a.addClass("has-error"),a.append(e("<span>").attr("class","label label-danger").text(l[n]))}}),n.removeClass().addClass("piplin piplin-save"),e("button.close",a).show(),a.find("input").removeAttr("disabled")}})}),Piplin.Server=Backbone.Model.extend({urlRoot:"/servers"});var i=Backbone.Collection.extend({model:Piplin.Server,comparator:function(e,i){return e.get("name")>i.get("name")?-1:e.get("name")<i.get("name")?1:0}});Piplin.Servers=new i,Piplin.ServersTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#server_list tbody"),e("#no_servers").show(),e("#server_list").hide(),this.listenTo(Piplin.Servers,"add",this.addOne),this.listenTo(Piplin.Servers,"reset",this.addAll),this.listenTo(Piplin.Servers,"remove",this.addAll),this.listenTo(Piplin.Servers,"all",this.render),Piplin.listener.on("server:"+Piplin.events.MODEL_CHANGED,function(e){var i=Piplin.Servers.get(parseInt(e.model.id));i&&(Piplin.targetable_id==e.model.targetable_id?i.set(e.model):Piplin.Servers.remove(i))}),Piplin.listener.on("server:"+Piplin.events.MODEL_CREATED,function(e){parseInt(e.model.targetable_id)===parseInt(Piplin.targetable_id)&&Piplin.Servers.add(e.model)}),
Piplin.listener.on("server:"+Piplin.events.MODEL_TRASHED,function(e){var i=Piplin.Servers.get(parseInt(e.model.id));i&&Piplin.Servers.remove(i)})},render:function(){Piplin.Servers.length?(e("#no_servers").hide(),e("#server_list").show()):(e("#no_servers").show(),e("#server_list").hide())},addOne:function(i){var t=new Piplin.ServerView({model:i});this.$list.append(t.render().el),Piplin.Servers.length<2?e(".drag-handle",this.$list).hide():e(".drag-handle",this.$list).show()},addAll:function(){this.$list.html(""),Piplin.Servers.each(this.addOne,this)}}),Piplin.ServerView=Backbone.View.extend({tagName:"tr",events:{"click .btn-test":"testConnection","click .btn-show":"showLog","click .btn-edit":"edit","click .btn-delete":"trash"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#server-template").html())},render:function(){var e=this.model.toJSON();return e.status_css="orange",e.icon_css="circle",e.status=trans("servers.untested"),0===parseInt(this.model.get("status"))?(e.status_css="success",e.status=trans("servers.successful")):3===parseInt(this.model.get("status"))?(e.status_css="purple",e.icon_css="load piplin-spin",e.status=trans("servers.testing")):2===parseInt(this.model.get("status"))&&(e.status_css="danger",e.status=trans("servers.failed")),this.$el.html(this.template(e)),this},edit:function(){e("#server_id").val(this.model.id),e("#server_name").val(this.model.get("name")),e("#server_targetable_id").select2(Piplin.select2_options).val(this.model.get("targetable_id")).trigger("change"),e("#server_enabled").prop("checked",!0===this.model.get("enabled")),e("#server_address").val(this.model.get("ip_address")),e("#server_port").val(this.model.get("port")),e("#server_user").val(this.model.get("user"))},showLog:function(){var i=this.model.toJSON();e("#log pre").html(i.output)},trash:function(){var i=e("#model_id");i.val(this.model.id),i.parents(".modal").removeClass().addClass("modal fade server-trash")},testConnection:function(){if(3!==parseInt(this.model.get("status"))){this.model.set({status:3});var i=this;e.ajax({type:"GET",url:this.model.urlRoot+"/"+this.model.id+"/test"}).fail(function(e){i.model.set({status:2})})}}})}(jQuery);