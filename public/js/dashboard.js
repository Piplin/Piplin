!function(e){e(".command-list table").sortable({containerSelector:"table",itemPath:"> tbody",itemSelector:"tr",placeholder:'<tr class="placeholder"/>',delay:500,onDrop:function(t,n,a){a(t,n);var i=[];e("tbody tr td:first-child",n.el[0]).each(function(t,n){i.push(e(n).data("command-id"))}),e.ajax({url:"/commands/reorder",method:"POST",data:{commands:i}})}});var t;e("#command").on("hidden.bs.modal",function(e){t.destroy()}),e("#command").on("show.bs.modal",function(n){var a=e(n.relatedTarget),i=e(this),o=trans("commands.create");t=ace.edit("command_script"),t.getSession().setMode("ace/mode/sh"),e(".btn-danger",i).hide(),e(".callout-danger",i).hide(),e(".has-error",i).removeClass("has-error"),e(".label-danger",i).remove(),a.hasClass("btn-edit")?(o=trans("commands.edit"),e(".btn-danger",i).show()):(e("#command_id").val(""),e("#command_step").val(a.data("step")),e("#command_name").val(""),t.setValue(""),t.gotoLine(1),e("#command_user").val(""),e("#command_optional").prop("checked",!1),e("#command_default_on").prop("checked",!1),e("#command_default_on_row").addClass("hide"),e(".command-server").prop("checked",!0),e(".command-environment").prop("checked",!0)),i.find(".modal-title span").text(o)}),e("body").delegate(".command-trash button.btn-delete","click",function(t){var n=e(t.currentTarget),a=n.find("i"),i=n.parents(".modal");a.addClass("ion-refresh fixhub-spin"),i.find("input").attr("disabled","disabled"),e("button.close",i).hide(),Fixhub.Commands.get(e("#model_id").val()).destroy({wait:!0,success:function(t,n,o){i.modal("hide"),e(".callout-danger",i).hide(),a.removeClass("ion-refresh fixhub-spin"),e("button.close",i).show(),i.find("input").removeAttr("disabled")},error:function(){a.removeClass("ion-refresh fixhub-spin"),e("button.close",i).show(),i.find("input").removeAttr("disabled")}})}),e("#command_optional").on("change",function(t){e("#command_default_on_row").addClass("hide"),!0===e(this).is(":checked")&&e("#command_default_on_row").removeClass("hide")}),e("#command button.btn-save").on("click",function(n){var a=e(n.currentTarget),i=a.find("i"),o=a.parents(".modal");i.addClass("ion-refresh fixhub-spin"),o.find(":input").attr("disabled","disabled"),e("button.close",o).hide();var s=e("#command_id").val();if(s)var r=Fixhub.Commands.get(s);else var r=new Fixhub.Command;var d=[];e(".command-server:checked").each(function(){d.push(e(this).val())});var l=[];e(".command-environment:checked").each(function(){l.push(e(this).val())}),r.save({name:e("#command_name").val(),script:t.getValue(),user:e("#command_user").val(),step:e("#command_step").val(),targetable_type:e('input[name="targetable_type"]').val(),targetable_id:e('input[name="targetable_id"]').val(),environments:l,optional:e("#command_optional").is(":checked"),default_on:e("#command_default_on").is(":checked")},{wait:!0,success:function(n,a,r){o.modal("hide"),e(".callout-danger",o).hide(),i.removeClass("ion-refresh fixhub-spin"),e("button.close",o).show(),o.find(":input").removeAttr("disabled"),s||Fixhub.Commands.add(a),t.setValue(""),t.gotoLine(1)},error:function(t,n,a){e(".callout-danger",o).show();var s=n.responseJSON;e(".has-error",o).removeClass("has-error"),e(".label-danger",o).remove(),e("form input",o).each(function(t,n){n=e(n);var a=n.attr("name");if(void 0!==s[a]){var i=n.parent("div");i.addClass("has-error"),i.append(e("<span>").attr("class","label label-danger").text(s[a]))}}),i.removeClass("ion-refresh fixhub-spin"),e("button.close",o).show(),o.find(":input").removeAttr("disabled")}})}),Fixhub.Command=Backbone.Model.extend({urlRoot:"/commands",defaults:function(){return{order:Fixhub.Commands.nextOrder()}},isAfter:function(){return parseInt(this.get("step"))%3==0}});var n=Backbone.Collection.extend({model:Fixhub.Command,comparator:"order",nextOrder:function(){return this.length?this.last().get("order")+1:1}});Fixhub.Commands=new n,Fixhub.CommandsTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$beforeList=e("#commands-before .command-list tbody"),this.$afterList=e("#commands-after .command-list tbody"),e(".no-commands").show(),e(".command-list").hide(),this.listenTo(Fixhub.Commands,"add",this.addOne),this.listenTo(Fixhub.Commands,"reset",this.addAll),this.listenTo(Fixhub.Commands,"remove",this.addAll),this.listenTo(Fixhub.Commands,"all",this.render),Fixhub.listener.on("command:Fixhub\\Bus\\Events\\ModelChangedEvent",function(e){var t=Fixhub.Commands.get(parseInt(e.model.id));t&&t.set(e.model)}),Fixhub.listener.on("command:Fixhub\\Bus\\Events\\ModelCreatedEvent",function(t){var n=e('input[name="targetable_type"]').val(),a=e('input[name="targetable_id"]').val();n==t.model.targetable_type&&parseInt(t.model.targetable_id)===parseInt(a)&&(parseInt(t.model.step)+1!==parseInt(Fixhub.command_action)&&parseInt(t.model.step)-1!==parseInt(Fixhub.command_action)||Fixhub.Commands.add(t.model))}),Fixhub.listener.on("command:Fixhub\\Bus\\Events\\ModelTrashedEvent",function(e){var t=Fixhub.Commands.get(parseInt(e.model.id));t&&Fixhub.Commands.remove(t)})},render:function(){void 0!==Fixhub.Commands.find(function(e){return!e.isAfter()})?(e("#commands-before .no-commands").hide(),e("#commands-before .command-list").show()):(e("#commands-before .no-commands").show(),e("#commands-before .command-list").hide()),void 0!==Fixhub.Commands.find(function(e){return e.isAfter()})?(e("#commands-after .no-commands").hide(),e("#commands-after .command-list").show()):(e("#commands-after .no-commands").show(),e("#commands-after .command-list").hide())},addOne:function(t){var n=new Fixhub.CommandView({model:t});t.isAfter()?(this.$afterList.append(n.render().el),e("tr",this.$afterList).length<2?e(".drag-handle",this.$afterList).hide():e(".drag-handle",this.$afterList).show()):(this.$beforeList.append(n.render().el),e("tr",this.$beforeList).length<2?e(".drag-handle",this.$beforeList).hide():e(".drag-handle",this.$beforeList).show())},addAll:function(){this.$beforeList.html(""),this.$afterList.html(""),Fixhub.Commands.each(this.addOne,this)}}),Fixhub.CommandView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"edit","click .btn-delete":"trash"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#command-template").html())},render:function(){var e=this.model.toJSON();return this.$el.html(this.template(e)),this},edit:function(){e("#command_id").val(this.model.id),e("#command_step").val(this.model.get("step")),e("#command_name").val(this.model.get("name")),e("#command_script").text(this.model.get("script")),e("#command_user").val(this.model.get("user")),e("#command_optional").prop("checked",!0===this.model.get("optional")),e("#command_default_on").prop("checked",!0===this.model.get("default_on")),e("#command_default_on_row").addClass("hide"),!0===this.model.get("optional")&&e("#command_default_on_row").removeClass("hide"),e(".command-environment").prop("checked",!1),e(this.model.get("environments")).each(function(t,n){e("#command_environment_"+n.id).prop("checked",!0)})},trash:function(){var t=e("#model_id");t.val(this.model.id),t.parents(".modal").removeClass().addClass("modal fade command-trash")}})}(jQuery),function(e){function t(t,i){a||(a=!0,e.ajax({type:"GET",url:"/log/"+i}).done(function(e){var a=n(e.output?e.output:""),i=!1;t.scrollTop()+t.innerHeight()>=t.get(0).scrollHeight&&(i=!0),t.html(a),i&&t.scrollTop(t.get(0).scrollHeight)}).always(function(){a=!1}))}function n(e){return e.replace(/<\/error>/g,"</span>").replace(/<\/info>/g,"</span>").replace(/<error>/g,'<span class="text-red">').replace(/<info>/g,'<span class="text-default">')}e("#redeploy").on("show.bs.modal",function(t){var n=e(t.relatedTarget),a=n.data("deployment-id"),i=n.data("optional-commands")+"",o=i.split(",");o=i.length>0?e.map(o,function(e){return parseInt(e,10)}):[];var s=e(this);e("form",s).prop("action","/deployment/"+a+"/rollback"),e("input:checkbox",s).each(function(t,n){var a=e(n);a.prop("checked",!1),-1!=e.inArray(parseInt(a.val(),10),o)&&a.prop("checked",!0)})}),e(".btn-cancel").on("click",function(t){var n=e(t.currentTarget),a=n.data("deployment-id");e("form#abort_"+a).trigger("submit")});var a=!1;e("#log").on("show.bs.modal",function(i){var o=e(i.relatedTarget),s=o.attr("id").replace("log_",""),r=e("h3 span",o.parents(".box")).text(),d=e(this),l=e("pre",d),h=e("#loading",d);l.hide(),h.show(),e("#action",d).text(r),l.text(""),a=!0,e.ajax({type:"GET",url:"/log/"+s}).done(function(e){var a=n(e.output?e.output:"");l.html(a),l.show(),h.hide(),Fixhub.listener.on("serverlog-"+s+":Fixhub\\Bus\\Events\\ServerOutputChangedEvent",function(e){e.log_id===parseInt(s)&&t(l,e.log_id)})}).always(function(){a=!1})}),e("#log").on("hide.bs.modal",function(){a=!1}),Fixhub.ServerLog=Backbone.Model.extend({urlRoot:"/status"});var i=Backbone.Collection.extend({model:Fixhub.ServerLog});Fixhub.Deployment=new i,Fixhub.DeploymentView=Backbone.View.extend({el:"#app",$containers:[],events:{},initialize:function(){var t=this;e(".deploy-step tbody").each(function(n,a){t.$containers.push({step:parseInt(e(a).attr("id").replace("step_","")),element:a})}),this.listenTo(Fixhub.Deployment,"add",this.addOne),this.listenTo(Fixhub.Deployment,"reset",this.addAll),this.listenTo(Fixhub.Deployment,"remove",this.addAll),this.listenTo(Fixhub.Deployment,"all",this.render),Fixhub.listener.on("serverlog:Fixhub\\Bus\\Events\\ServerLogChangedEvent",function(e){var t=Fixhub.Deployment.get(e.log_id);t&&t.set({status:e.status,output:e.output,runtime:e.runtime,started_at:!!e.started_at&&e.started_at,finished_at:!!e.finished_at&&e.finished_at})}),Fixhub.listener.on("deployment:Fixhub\\Bus\\Events\\ModelChangedEvent",function(t){parseInt(t.model.project_id)===parseInt(Fixhub.project_id)&&(t.model.deploy_failure?(e("#deploy_status").find("p").text(t.model.output),e("#deploy_status").removeClass("hide").show()):e("#deploy_status").hide())})},addOne:function(t){var n=new Fixhub.LogView({model:t}),a=_.find(this.$containers,function(e){return parseInt(e.step)===parseInt(t.get("deploy_step_id"))});e(a.element).append(n.render().el)},addAll:function(){e(this.$containers).each(function(e,t){t.html("")}),Fixhub.Commands.each(this.addOne,this)}}),Fixhub.LogView=Backbone.View.extend({tagName:"tr",events:{},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#log-template").html())},render:function(){var e=this.model.toJSON();return e.status_css="info",e.icon_css="clock",e.status=trans("deployments.pending"),0===parseInt(this.model.get("status"))?(e.status_css="success",e.icon_css="checkmark-round",e.status=trans("deployments.completed")):2===parseInt(this.model.get("status"))?(e.status_css="warning",e.icon_css="load-c fixhub-spin",e.status=trans("deployments.running")):3!==parseInt(this.model.get("status"))&&4!==parseInt(this.model.get("status"))||(e.status_css="danger",e.icon_css="close-round",e.status=trans("deployments.failed"),4===parseInt(this.model.get("status"))&&(e.status=trans("deployments.cancelled"))),e.formatted_start_time=!!e.started_at&&moment(e.started_at).format("HH:mm:ss"),e.formatted_end_time=!!e.finished_at&&moment(e.finished_at).format("HH:mm:ss"),this.$el.html(this.template(e)),this}})}(jQuery),function(e){function t(t,n){e("#hook .modal-title span").text(trans("hooks."+n+"_"+t));var a=e("#hook .modal-title i").removeClass().addClass("ion"),i="cogs";"slack"===t?i="pound":"mail"===t?i="email":"custom"===t&&(i="compose"),a.addClass("ion-"+i),e("#hook .modal-footer").show(),e(".hook-config").hide(),e("#hook-type").hide(),e("#hook-name").show(),e("#hook-triggers").show(),e(".hook-enabled").show(),e("#hook-config-"+t).show(),e("#hook_type").val(t)}e("#hook").on("show.bs.modal",function(t){var n=e(t.relatedTarget),a=e(this);e(".btn-danger",a).hide(),e(".callout-danger",a).hide(),e(".callout-warning",a).hide(),e(".has-error",a).removeClass("has-error"),e(".label-danger",a).remove(),n.hasClass("btn-edit")?e(".btn-danger",a).show():(e("#hook_id").val(""),e("#hook_name").val(""),e("#hook_type").val(""),e("#hook :input[id^=hook_config]").val(""),e("#hook .hook-config input[type=checkbox]").prop("checked",!0),e("#hook .hook-enabled input[type=checkbox]").prop("checked",!0),e("#hook .modal-footer").hide(),e(".hook-config").hide(),e(".hook-enabled").hide(),e("#hook-type").show(),a.find(".modal-title span").text(trans("hooks.create")))}),e("#hook #hook-type a.btn-app").on("click",function(n){var a=e(n.currentTarget),i=e("#hook");if(a.attr("disabled"))return void e(".callout-warning",i).show();e(".callout-warning",i).hide(),t(a.data("type"),"create")}),e("body").delegate(".hook-trash button.btn-delete","click",function(t){var n=e(t.currentTarget),a=n.find("i"),i=n.parents(".modal");a.addClass("ion-load-c fixhub-spin"),i.find("input").attr("disabled","disabled"),e("button.close",i).hide(),Fixhub.Hooks.get(e("#model_id").val()).destroy({wait:!0,success:function(t,n,o){i.modal("hide"),e(".callout-danger",i).hide(),a.removeClass(),e("button.close",i).show(),i.find("input").removeAttr("disabled")},error:function(){a.removeClass(),e("button.close",i).show(),i.find("input").removeAttr("disabled")}})}),e("#hook button.btn-save").on("click",function(t){var n=e(t.currentTarget),a=n.find("i"),i=n.parents(".modal");a.addClass("ion-load-c fixhub-spin"),i.find("input").attr("disabled","disabled"),e("button.close",i).hide();var o=e("#hook_id").val();if(o)var s=Fixhub.Hooks.get(o);else var s=new Fixhub.Hook;var r={config:null,name:e("#hook_name").val(),type:e("#hook_type").val(),project_id:parseInt(e('input[name="project_id"]').val()),enabled:e("#hook_enabled").is(":checked"),on_deployment_success:e("#hook_on_deployment_success").is(":checked"),on_deployment_failure:e("#hook_on_deployment_failure").is(":checked")};e("#hook #hook-config-"+r.type+" :input[id^=hook_config]").each(function(t,n){var a=e(n).attr("name");r[a]=e(n).val()}),s.save(r,{wait:!0,success:function(t,n,s){i.modal("hide"),e(".callout-danger",i).hide(),a.removeClass(),e("button.close",i).show(),i.find("input").removeAttr("disabled"),o||Fixhub.Hooks.add(n)},error:function(t,n,o){e(".callout-danger",i).show();var s=n.responseJSON;e(".has-error",i).removeClass("has-error"),e(".label-danger",i).remove(),e("form input",i).each(function(t,n){n=e(n);var a=n.attr("name");if(void 0!==s[a]){var i=n.parents("div.form-group");i.addClass("has-error"),i.append(e("<span>").attr("class","label label-danger").text(s[a]))}}),a.removeClass(),e("button.close",i).show(),i.find("input").removeAttr("disabled")}})}),Fixhub.Hook=Backbone.Model.extend({urlRoot:"/hooks"});var n=Backbone.Collection.extend({model:Fixhub.Hook});Fixhub.Hooks=new n,Fixhub.HooksTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#hook_list tbody"),e("#no_hooks").show(),e("#hook_list").hide(),this.listenTo(Fixhub.Hooks,"add",this.addOne),this.listenTo(Fixhub.Hooks,"reset",this.addAll),this.listenTo(Fixhub.Hooks,"remove",this.addAll),this.listenTo(Fixhub.Hooks,"all",this.render),Fixhub.listener.on("hook:Fixhub\\Bus\\Events\\ModelChangedEvent",function(e){var t=Fixhub.Hooks.get(parseInt(e.model.id));t&&t.set(e.model)}),Fixhub.listener.on("hook:Fixhub\\Bus\\Events\\ModelCreatedEvent",function(e){parseInt(e.model.project_id)===parseInt(Fixhub.project_id)&&Fixhub.Hooks.add(e.model)}),Fixhub.listener.on("hook:Fixhub\\Bus\\Events\\ModelTrashedEvent",function(e){var t=Fixhub.Hooks.get(parseInt(e.model.id));t&&Fixhub.Hooks.remove(t)})},render:function(){Fixhub.Hooks.length?(e("#no_hooks").hide(),e("#hook_list").show()):(e("#no_hooks").show(),e("#hook_list").hide())},addOne:function(e){var t=new Fixhub.HookView({model:e});this.$list.append(t.render().el)},addAll:function(){this.$list.html(""),Fixhub.Hooks.each(this.addOne,this)}}),Fixhub.HookView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"edit","click .btn-delete":"trash"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#hook-template").html())},render:function(){var e=this.model.toJSON();return e.icon="compose",e.label=trans("hooks.custom"),"custom"!==this.model.get("type")&&(e.label=trans("hooks."+this.model.get("type"))),"slack"===this.model.get("type")?e.icon="pound":"mail"===this.model.get("type")&&(e.icon="email"),this.$el.html(this.template(e)),this},edit:function(){var n=this.model.get("type");e.each(this.model.get("config"),function(t,a){e("#hook-config-"+n+" #hook_config_"+t).val(a)}),e("#hook_id").val(this.model.id),e("#hook_name").val(this.model.get("name")),e("#hook_type").val(n),e("#hook_enabled").prop("checked",!0===this.model.get("enabled")),e("#hook_on_deployment_success").prop("checked",!0===this.model.get("on_deployment_success")),e("#hook_on_deployment_failure").prop("checked",!0===this.model.get("on_deployment_failure")),t(this.model.get("type"),"edit")},trash:function(){var t=e("#model_id");t.val(this.model.id),t.parents(".modal").removeClass().addClass("modal fade hook-trash")}})}(jQuery),function(e){if(0!==e("#upload").length){e("#skin").on("change",function(){e("body").removeClass(),e("body").addClass("skin-"+e(this).find(":selected").val())}),e("#two-factor-auth").on("change",function(){var t=e(".auth-code");e(this).is(":checked")?t.removeClass("hide"):t.addClass("hide")}),e("#request-change-email").on("click",function(){var t=e(this).parents(".box");t.children(".overlay").removeClass("hide"),e.post("/profile/email",function(e){"success"==e&&(t.children(".overlay").addClass("hide"),t.find(".help-block").removeClass("hide"))})});var t={};e(".avatar>img").cropper({aspectRatio:1,preview:".avatar-preview",crop:function(e){t.dataX=Math.round(e.x),t.dataY=Math.round(e.y),t.dataHeight=Math.round(e.height),t.dataWidth=Math.round(e.width),t.dataRotate=Math.round(e.rotate)},built:function(){e("#upload-overlay").addClass("hide")}});new Uploader({trigger:"#upload",name:"file",action:"/profile/upload",accept:"image/*",data:{_token:e('meta[name="token"]').attr("content")},multiple:!1,change:function(){e("#upload-overlay").removeClass("hide"),this.submit()},error:function(t){t.responseJSON.file?alert(t.responseJSON.file.join("")):t.responseJSON.error&&alert(t.responseJSON.error.message),e("#upload-overlay").addClass("hide")},success:function(n){"success"===n.message&&(e(".avatar>img").cropper("replace",n.image),t.path=n.path,e(".current-avatar-preview").addClass("hide"),e(".avatar-preview").removeClass("hide"),e("#save-avatar").removeClass("hide"))}});e("#save-avatar").on("click",function(){e("#upload-overlay").removeClass("hide"),e(".avatar-message .alert").addClass("hide"),e.post("/profile/avatar",t).success(function(t){e("#upload-overlay").addClass("hide"),t.image?(e(".avatar-message .alert.alert-success").removeClass("hide"),e("#use-gravatar").removeClass("hide")):e(".avatar-message .alert.alert-danger").removeClass("hide")})}),e("#use-gravatar").on("click",function(){e("#upload-overlay").removeClass("hide"),e(".avatar-message .alert").addClass("hide"),e.post("/profile/gravatar").success(function(t){e("#upload-overlay").addClass("hide"),e(".avatar-message .alert.alert-success").removeClass("hide"),e(".avatar-preview").addClass("hide"),e(".current-avatar-preview").removeClass("hide"),e(".current-avatar-preview").attr("src",t.image),e("#use-gravatar").addClass("hide"),e("#avatar-save-buttons button").addClass("hide")})})}}(jQuery),function(e){e("select.deployment-source").select2({width:"100%",minimumResultsForSearch:6}),e(".deployment-source:radio").on("change",function(t){var n=e(t.currentTarget);e("div.deployment-source-container").hide(),"branch"===n.val()?e("#deployment_branch").parent("div").show():"tag"===n.val()?e("#deployment_tag").parent("div").show():"commit"===n.val()&&e("#deployment_commit").parent("div").show()}),e("#deploy").on("show.bs.modal",function(t){var n=e(this);e(".callout-danger",n).hide()}),e("#deploy button.btn-save").on("click",function(t){var n=e(t.currentTarget),a=n.find("i"),i=n.parents(".modal"),o=e("input[name=source]:checked").val();if(e(".has-error",o).removeClass("has-error"),("branch"===o||"tag"===o||"commit"===o)&&""===e("#deployment_"+o).val())return e("#deployment_"+o).parentsUntil("div").addClass("has-error"),e(".callout-danger",i).show(),void t.stopPropagation();a.addClass("ion-refresh fixhub-spin"),e("button.close",i).hide()}),e(".repo-refresh").on("click",function(t){var n=e(t.currentTarget),a=n.data("project-id"),i=e("i",n);e(".fixhub-spin",n).length>0||(e("span",n).html("loading"),n.attr("disabled","disabled"),i.addClass("fixhub-spin"),e.ajax({type:"GET",url:"/repository/"+a+"/refresh"}).fail(function(e){}).done(function(t){e("span",n).html(t.last_mirrored).addClass("text-success")}).always(function(){i.removeClass("fixhub-spin"),n.removeAttr("disabled")}))}),e("#new_webhook").on("click",function(t){var n=e(t.currentTarget),a=n.data("project-id"),i=e("i",n);e(".fixhub-spin",n).length>0||(n.attr("disabled","disabled"),i.addClass("fixhub-spin"),e("#webhook").fadeOut(3e3),e.ajax({type:"GET",url:"/webhook/"+a+"/refresh"}).fail(function(e){}).done(function(t){e("#webhook").fadeIn(3e3).html(t.url)}).always(function(){i.removeClass("fixhub-spin"),n.removeAttr("disabled")}))})}(jQuery),function(e){e("#server_list table").sortable({containerSelector:"table",itemPath:"> tbody",itemSelector:"tr",placeholder:'<tr class="placeholder"/>',delay:500,onDrop:function(t,n,a){a(t,n);var i=[];e("tbody tr td:first-child",n.el[0]).each(function(t,n){i.push(e(n).data("server-id"))}),e.ajax({url:"/servers/reorder",method:"POST",data:{servers:i}})}}),e("#server").on("show.bs.modal",function(t){var n=e(t.relatedTarget),a=e(this),i=trans("servers.create");e(".btn-danger",a).hide(),e(".callout-danger",a).hide(),e(".has-error",a).removeClass("has-error"),e(".label-danger",a).remove(),n.hasClass("btn-edit")?(i=trans("servers.edit"),e(".btn-danger",a).show()):(e("#server_id").val(""),e("#server_name").val(""),e("#server_enabled").prop("checked",!0),e("#server_address").val(""),e("#server_port").val("22"),e("#server_user").val(""),e("#server_path").val(""),e("#server_environment_id").val(e("#server_environment_id option:selected").val()),e("#server_deploy_code").prop("checked",!0)),a.find(".modal-title span").text(i)}),e("body").delegate(".server-trash button.btn-delete","click",function(t){var n=e(t.currentTarget),a=n.find("i"),i=n.parents(".modal");a.addClass("ion-refresh fixhub-spin"),i.find("input").attr("disabled","disabled"),e("button.close",i).hide(),Fixhub.Servers.get(e("#model_id").val()).destroy({wait:!0,success:function(t,n,o){i.modal("hide"),e(".callout-danger",i).hide(),a.removeClass("ion-refresh fixhub-spin"),e("button.close",i).show(),i.find("input").removeAttr("disabled")},error:function(){a.removeClass("ion-refresh fixhub-spin"),e("button.close",i).show(),i.find("input").removeAttr("disabled")}})}),e("#server button.btn-save").on("click",function(t){var n=e(t.currentTarget),a=n.find("i"),i=n.parents(".modal");a.addClass("ion-refresh fixhub-spin"),i.find("input").attr("disabled","disabled"),e("button.close",i).hide();var o=e("#server_id").val();if(o)var s=Fixhub.Servers.get(o);else var s=new Fixhub.Server;s.save({name:e("#server_name").val(),ip_address:e("#server_address").val(),enabled:e("#server_enabled").is(":checked"),port:e("#server_port").val(),user:e("#server_user").val(),path:e("#server_path").val(),deploy_code:e("#server_deploy_code").is(":checked"),environment_id:e("#server_environment_id").val()},{wait:!0,success:function(t,n,s){i.modal("hide"),e(".callout-danger",i).hide(),a.removeClass("ion-refresh fixhub-spin"),e("button.close",i).show(),i.find("input").removeAttr("disabled"),o||Fixhub.Servers.add(n)},error:function(t,n,o){e(".callout-danger",i).show();var s=n.responseJSON;e(".has-error",i).removeClass("has-error"),e(".label-danger",i).remove(),e("form input",i).each(function(t,n){n=e(n);var a=n.attr("name");if(void 0!==s[a]){var i=n.parent("div");i.addClass("has-error"),i.append(e("<span>").attr("class","label label-danger").text(s[a]))}}),a.removeClass("ion-refresh fixhub-spin"),e("button.close",i).show(),i.find("input").removeAttr("disabled")}})}),Fixhub.Server=Backbone.Model.extend({urlRoot:"/servers"});var t=Backbone.Collection.extend({model:Fixhub.Server,comparator:function(e,t){return e.get("name")>t.get("name")?-1:e.get("name")<t.get("name")?1:0}});Fixhub.Servers=new t,Fixhub.ServersTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#server_list tbody"),e("#no_servers").show(),e("#server_list").hide(),this.listenTo(Fixhub.Servers,"add",this.addOne),this.listenTo(Fixhub.Servers,"reset",this.addAll),this.listenTo(Fixhub.Servers,"remove",this.addAll),this.listenTo(Fixhub.Servers,"all",this.render),Fixhub.listener.on("server:Fixhub\\Bus\\Events\\ModelChangedEvent",function(e){var t=Fixhub.Servers.get(parseInt(e.model.id));t&&(Fixhub.environment_id==e.model.environment_id?t.set(e.model):Fixhub.Servers.remove(t))}),Fixhub.listener.on("server:Fixhub\\Bus\\Events\\ModelCreatedEvent",function(e){parseInt(e.model.environment_id)===parseInt(Fixhub.environment_id)&&Fixhub.Servers.add(e.model)}),Fixhub.listener.on("server:Fixhub\\Bus\\Events\\ModelTrashedEvent",function(e){var t=Fixhub.Servers.get(parseInt(e.model.id));t&&Fixhub.Servers.remove(t)})},render:function(){Fixhub.Servers.length?(e("#no_servers").hide(),e("#server_list").show()):(e("#no_servers").show(),e("#server_list").hide())},addOne:function(t){var n=new Fixhub.ServerView({model:t});this.$list.append(n.render().el),Fixhub.Servers.length<2?e(".drag-handle",this.$list).hide():e(".drag-handle",this.$list).show()},addAll:function(){this.$list.html(""),Fixhub.Servers.each(this.addOne,this)}}),Fixhub.ServerView=Backbone.View.extend({tagName:"tr",events:{"click .btn-test":"testConnection","click .btn-show":"showLog","click .btn-edit":"edit","click .btn-delete":"trash"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#server-template").html())},render:function(){var e=this.model.toJSON();return e.status_css="primary",e.icon_css="help",e.status=trans("servers.untested"),0===parseInt(this.model.get("status"))?(e.status_css="success",e.icon_css="checkmark-round",e.status=trans("servers.successful")):3===parseInt(this.model.get("status"))?(e.status_css="warning",e.icon_css="load-c fixhub-spin",e.status=trans("servers.testing")):2===parseInt(this.model.get("status"))&&(e.status_css="danger",e.icon_css="close-round",e.status=trans("servers.failed")),this.$el.html(this.template(e)),this},edit:function(){e("#server_id").val(this.model.id),e("#server_name").val(this.model.get("name")),e("#server_enabled").prop("checked",!0===this.model.get("enabled")),e("#server_address").val(this.model.get("ip_address")),e("#server_port").val(this.model.get("port")),e("#server_user").val(this.model.get("user")),e("#server_path").val(this.model.get("path")),e("#server_deploy_code").prop("checked",!0===this.model.get("deploy_code"))},showLog:function(){var t=this.model.toJSON();e("#log pre").html(t.output)},trash:function(){var t=e("#model_id");t.val(this.model.id),t.parents(".modal").removeClass().addClass("modal fade server-trash")},testConnection:function(){if(3!==parseInt(this.model.get("status"))){this.model.set({status:3});var t=this;e.ajax({type:"GET",url:this.model.urlRoot+"/"+this.model.id+"/test"}).fail(function(e){t.model.set({status:2})})}}})}(jQuery),function(e){e(".command-list table").sortable({containerSelector:"table",itemPath:"> tbody",itemSelector:"tr",placeholder:'<tr class="placeholder"/>',delay:500,onDrop:function(t,n,a){a(t,n);var i=[];e("tbody tr td:first-child",n.el[0]).each(function(t,n){i.push(e(n).data("command-id"))}),e.ajax({url:"/commands/reorder",method:"POST",data:{commands:i}})}});var t;e("#command").on("hidden.bs.modal",function(e){t.destroy()}),e("#command").on("show.bs.modal",function(n){var a=e(n.relatedTarget),i=e(this),o=trans("commands.create");t=ace.edit("command_script"),t.getSession().setMode("ace/mode/sh"),e(".btn-danger",i).hide(),e(".callout-danger",i).hide(),e(".has-error",i).removeClass("has-error"),e(".label-danger",i).remove(),a.hasClass("btn-edit")?(o=trans("commands.edit"),e(".btn-danger",i).show()):(e("#command_id").val(""),e("#command_step").val(a.data("step")),e("#command_name").val(""),t.setValue(""),t.gotoLine(1),e("#command_user").val(""),e("#command_optional").prop("checked",!1),e("#command_default_on").prop("checked",!1),e("#command_default_on_row").addClass("hide"),e(".command-server").prop("checked",!0),e(".command-environment").prop("checked",!0)),i.find(".modal-title span").text(o)}),e("body").delegate(".command-trash button.btn-delete","click",function(t){var n=e(t.currentTarget),a=n.find("i"),i=n.parents(".modal");a.addClass("ion-refresh fixhub-spin"),i.find("input").attr("disabled","disabled"),e("button.close",i).hide(),Fixhub.Commands.get(e("#model_id").val()).destroy({wait:!0,success:function(t,n,o){i.modal("hide"),e(".callout-danger",i).hide(),a.removeClass("ion-refresh fixhub-spin"),e("button.close",i).show(),i.find("input").removeAttr("disabled")},error:function(){a.removeClass("ion-refresh fixhub-spin"),e("button.close",i).show(),i.find("input").removeAttr("disabled")}})}),e("#command_optional").on("change",function(t){e("#command_default_on_row").addClass("hide"),!0===e(this).is(":checked")&&e("#command_default_on_row").removeClass("hide")}),e("#command button.btn-save").on("click",function(n){var a=e(n.currentTarget),i=a.find("i"),o=a.parents(".modal");i.addClass("ion-refresh fixhub-spin"),o.find(":input").attr("disabled","disabled"),e("button.close",o).hide();var s=e("#command_id").val();if(s)var r=Fixhub.Commands.get(s);else var r=new Fixhub.Command;var d=[];e(".command-server:checked").each(function(){d.push(e(this).val())});var l=[];e(".command-environment:checked").each(function(){l.push(e(this).val())}),r.save({name:e("#command_name").val(),script:t.getValue(),user:e("#command_user").val(),step:e("#command_step").val(),targetable_type:e('input[name="targetable_type"]').val(),targetable_id:e('input[name="targetable_id"]').val(),environments:l,optional:e("#command_optional").is(":checked"),default_on:e("#command_default_on").is(":checked")},{wait:!0,success:function(n,a,r){o.modal("hide"),e(".callout-danger",o).hide(),i.removeClass("ion-refresh fixhub-spin"),e("button.close",o).show(),o.find(":input").removeAttr("disabled"),s||Fixhub.Commands.add(a),t.setValue(""),t.gotoLine(1)},error:function(t,n,a){e(".callout-danger",o).show();var s=n.responseJSON;e(".has-error",o).removeClass("has-error"),e(".label-danger",o).remove(),e("form input",o).each(function(t,n){n=e(n);var a=n.attr("name");if(void 0!==s[a]){var i=n.parent("div");i.addClass("has-error"),i.append(e("<span>").attr("class","label label-danger").text(s[a]))}}),i.removeClass("ion-refresh fixhub-spin"),e("button.close",o).show(),o.find(":input").removeAttr("disabled")}})}),Fixhub.Command=Backbone.Model.extend({urlRoot:"/commands",defaults:function(){return{order:Fixhub.Commands.nextOrder()}},isAfter:function(){return parseInt(this.get("step"))%3==0}});var n=Backbone.Collection.extend({model:Fixhub.Command,comparator:"order",nextOrder:function(){return this.length?this.last().get("order")+1:1}});Fixhub.Commands=new n,Fixhub.CommandsTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$beforeList=e("#commands-before .command-list tbody"),this.$afterList=e("#commands-after .command-list tbody"),e(".no-commands").show(),e(".command-list").hide(),this.listenTo(Fixhub.Commands,"add",this.addOne),this.listenTo(Fixhub.Commands,"reset",this.addAll),this.listenTo(Fixhub.Commands,"remove",this.addAll),this.listenTo(Fixhub.Commands,"all",this.render),Fixhub.listener.on("command:Fixhub\\Bus\\Events\\ModelChangedEvent",function(e){var t=Fixhub.Commands.get(parseInt(e.model.id))
;t&&t.set(e.model)}),Fixhub.listener.on("command:Fixhub\\Bus\\Events\\ModelCreatedEvent",function(t){var n=e('input[name="targetable_type"]').val(),a=e('input[name="targetable_id"]').val();n==t.model.targetable_type&&parseInt(t.model.targetable_id)===parseInt(a)&&(parseInt(t.model.step)+1!==parseInt(Fixhub.command_action)&&parseInt(t.model.step)-1!==parseInt(Fixhub.command_action)||Fixhub.Commands.add(t.model))}),Fixhub.listener.on("command:Fixhub\\Bus\\Events\\ModelTrashedEvent",function(e){var t=Fixhub.Commands.get(parseInt(e.model.id));t&&Fixhub.Commands.remove(t)})},render:function(){void 0!==Fixhub.Commands.find(function(e){return!e.isAfter()})?(e("#commands-before .no-commands").hide(),e("#commands-before .command-list").show()):(e("#commands-before .no-commands").show(),e("#commands-before .command-list").hide()),void 0!==Fixhub.Commands.find(function(e){return e.isAfter()})?(e("#commands-after .no-commands").hide(),e("#commands-after .command-list").show()):(e("#commands-after .no-commands").show(),e("#commands-after .command-list").hide())},addOne:function(t){var n=new Fixhub.CommandView({model:t});t.isAfter()?(this.$afterList.append(n.render().el),e("tr",this.$afterList).length<2?e(".drag-handle",this.$afterList).hide():e(".drag-handle",this.$afterList).show()):(this.$beforeList.append(n.render().el),e("tr",this.$beforeList).length<2?e(".drag-handle",this.$beforeList).hide():e(".drag-handle",this.$beforeList).show())},addAll:function(){this.$beforeList.html(""),this.$afterList.html(""),Fixhub.Commands.each(this.addOne,this)}}),Fixhub.CommandView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"edit","click .btn-delete":"trash"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#command-template").html())},render:function(){var e=this.model.toJSON();return this.$el.html(this.template(e)),this},edit:function(){e("#command_id").val(this.model.id),e("#command_step").val(this.model.get("step")),e("#command_name").val(this.model.get("name")),e("#command_script").text(this.model.get("script")),e("#command_user").val(this.model.get("user")),e("#command_optional").prop("checked",!0===this.model.get("optional")),e("#command_default_on").prop("checked",!0===this.model.get("default_on")),e("#command_default_on_row").addClass("hide"),!0===this.model.get("optional")&&e("#command_default_on_row").removeClass("hide"),e(".command-environment").prop("checked",!1),e(this.model.get("environments")).each(function(t,n){e("#command_environment_"+n.id).prop("checked",!0)})},trash:function(){var t=e("#model_id");t.val(this.model.id),t.parents(".modal").removeClass().addClass("modal fade command-trash")}})}(jQuery),function(e){var t,n;e("#configfile, #view-configfile").on("hidden.bs.modal",function(e){t.destroy()}),e("#view-configfile").on("show.bs.modal",function(e){t=ace.edit("preview-content"),t.setReadOnly(!0),t.getSession().setUseWrapMode(!0);var a=n.substr(n.lastIndexOf(".")+1).toLowerCase();"php"===a||"ini"===a?t.getSession().setMode("ace/mode/"+a):"yml"===a&&t.getSession().setMode("ace/mode/yaml")}),e("#configfile").on("show.bs.modal",function(n){var a=e(n.relatedTarget),i=e(this),o=trans("configFiles.create");t=ace.edit("content");var s=e("#path").val(),r=s.substr(s.lastIndexOf(".")+1).toLowerCase();"php"===r||"ini"===r?t.getSession().setMode("ace/mode/"+r):"yml"===r&&t.getSession().setMode("ace/mode/yaml"),e(".btn-danger",i).hide(),e(".callout-danger",i).hide(),e(".has-error",i).removeClass("has-error"),e(".label-danger",i).remove(),a.hasClass("btn-edit")?(o=trans("configFiles.edit"),e(".btn-danger",i).show()):(e("#file_id").val(""),e("#name").val(""),e("#path").val(""),t.setValue(""),t.gotoLine(1)),i.find(".modal-title span").text(o)}),e("body").delegate(".configfile-trash button.btn-delete","click",function(t){var n=e(t.currentTarget),a=n.find("i"),i=n.parents(".modal");a.addClass("ion-refresh fixhub-spin"),i.find("input").attr("disabled","disabled"),e("button.close",i).hide(),Fixhub.ConfigFiles.get(e("#model_id").val()).destroy({wait:!0,success:function(t,n,o){i.modal("hide"),e(".callout-danger",i).hide(),a.removeClass("ion-refresh fixhub-spin"),e("button.close",i).show(),i.find("input").removeAttr("disabled")},error:function(){a.removeClass("ion-refresh fixhub-spin"),e("button.close",i).show(),i.find("input").removeAttr("disabled")}})}),e("#configfile button.btn-save").on("click",function(n){var a=e(n.currentTarget),i=a.find("i"),o=a.parents(".modal");i.addClass("ion-refresh fixhub-spin"),o.find("input").attr("disabled","disabled"),e("button.close",o).hide();var s=e("#config_file_id").val();if(s)var r=Fixhub.ConfigFiles.get(s);else var r=new Fixhub.ConfigFile;r.save({name:e("#name").val(),path:e("#path").val(),targetable_type:e('input[name="targetable_type"]').val(),targetable_id:e('input[name="targetable_id"]').val(),content:t.getValue()},{wait:!0,success:function(n,a,r){o.modal("hide"),e(".callout-danger",o).hide(),i.removeClass("ion-refresh fixhub-spin"),e("button.close",o).show(),o.find("input").removeAttr("disabled"),s||Fixhub.ConfigFiles.add(a),t.setValue(""),t.gotoLine(1)},error:function(t,n,a){e(".callout-danger",o).show();var s=n.responseJSON;e(".has-error",o).removeClass("has-error"),e(".label-danger",o).remove(),e("form input",o).each(function(t,n){n=e(n);var a=n.attr("name");if(void 0!==s[a]){var i=n.parent("div");i.addClass("has-error"),i.append(e("<span>").attr("class","label label-danger").text(s[a]))}}),i.removeClass("ion-refresh fixhub-spin"),e("button.close",o).show(),o.find("input").removeAttr("disabled")}})}),Fixhub.ConfigFile=Backbone.Model.extend({urlRoot:"/config-file"});var a=Backbone.Collection.extend({model:Fixhub.ConfigFile});Fixhub.ConfigFiles=new a,Fixhub.ConfigFilesTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#configfile_list tbody"),e("#no_configfiles").show(),e("#configfile_list").hide(),this.listenTo(Fixhub.ConfigFiles,"add",this.addOne),this.listenTo(Fixhub.ConfigFiles,"reset",this.addAll),this.listenTo(Fixhub.ConfigFiles,"remove",this.addAll),this.listenTo(Fixhub.ConfigFiles,"all",this.render),Fixhub.listener.on("configfile:Fixhub\\Bus\\Events\\ModelChangedEvent",function(e){var t=Fixhub.ConfigFiles.get(parseInt(e.model.id));t&&t.set(e.model)}),Fixhub.listener.on("configfile:Fixhub\\Bus\\Events\\ModelCreatedEvent",function(t){var n=e('input[name="targetable_type"]').val(),a=e('input[name="targetable_id"]').val();n==t.model.targetable_type&&parseInt(t.model.targetable_id)===parseInt(a)&&Fixhub.ConfigFiles.add(t.model)}),Fixhub.listener.on("configfile:Fixhub\\Bus\\Events\\ModelTrashedEvent",function(e){var t=Fixhub.ConfigFiles.get(parseInt(e.model.id));t&&Fixhub.ConfigFiles.remove(t)})},render:function(){Fixhub.ConfigFiles.length?(e("#no_configfiles").hide(),e("#configfile_list").show()):(e("#no_configfiles").show(),e("#configfile_list").hide())},addOne:function(e){var t=new Fixhub.ConfigFileView({model:e});this.$list.append(t.render().el)},addAll:function(){this.$list.html(""),Fixhub.ConfigFiles.each(this.addOne,this)}}),Fixhub.ConfigFileView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"edit","click .btn-delete":"trash","click .btn-view":"view"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#configfiles-template").html())},render:function(){var e=this.model.toJSON();return this.$el.html(this.template(e)),this},view:function(){n=this.model.get("path"),e("#preview-content").text(this.model.get("content"))},edit:function(){e("#config_file_id").val(this.model.id),e("#name").val(this.model.get("name")),e("#path").val(this.model.get("path")),e("#content").text(this.model.get("content"))},trash:function(){var t=e("#model_id");t.val(this.model.id),t.parents(".modal").removeClass().addClass("modal fade configfile-trash")}})}(jQuery),function(e){e("#environment_list table").sortable({containerSelector:"table",itemPath:"> tbody",itemSelector:"tr",placeholder:'<tr class="placeholder"/>',delay:500,onDrop:function(t,n,a){a(t,n);var i=[];e("tbody tr td:first-child",n.el[0]).each(function(t,n){i.push(e(n).data("environment-id"))}),e.ajax({url:"/environments/reorder",method:"POST",data:{environments:i}})}}),e("#environment").on("show.bs.modal",function(t){var n=e(t.relatedTarget),a=e(this),i=trans("environments.create");e(".btn-danger",a).hide(),e(".callout-danger",a).hide(),e(".has-error",a).removeClass("has-error"),e(".label-danger",a).remove(),e("#add-environment-command",a).hide(),n.hasClass("btn-edit")?(i=trans("environments.edit"),e(".btn-danger",a).show()):(e("#environment_id").val(""),e("#environment_name").val(""),e("#environment_description").val(""),e("#environment_default_on").prop("checked",!0),e("#add-environment-command",a).show()),a.find(".modal-title span").text(i)}),e("body").delegate(".environment-trash button.btn-delete","click",function(t){var n=e(t.currentTarget),a=n.find("i"),i=n.parents(".modal");a.addClass("ion-refresh fixhub-spin"),i.find("input").attr("disabled","disabled"),e("button.close",i).hide(),Fixhub.Environments.get(e("#model_id").val()).destroy({wait:!0,success:function(t,n,o){i.modal("hide"),e(".callout-danger",i).hide(),a.removeClass("ion-refresh fixhub-spin"),e("button.close",i).show(),i.find("input").removeAttr("disabled")},error:function(){a.removeClass("ion-refresh fixhub-spin"),e("button.close",i).show(),i.find("input").removeAttr("disabled")}})}),e("#environment button.btn-save").on("click",function(t){var n=e(t.currentTarget),a=n.find("i"),i=n.parents(".modal");a.addClass("ion-refresh fixhub-spin"),i.find("input").attr("disabled","disabled"),e("button.close",i).hide();var o=e("#environment_id").val();if(o)var s=Fixhub.Environments.get(o);else var s=new Fixhub.Environment;s.save({name:e("#environment_name").val(),description:e("#environment_description").val(),default_on:e("#environment_default_on").is(":checked"),targetable_type:e('input[name="targetable_type"]').val(),targetable_id:e('input[name="targetable_id"]').val(),add_commands:e("#environment_commands").is(":checked")},{wait:!0,success:function(t,n,s){i.modal("hide"),e(".callout-danger",i).hide(),a.removeClass("ion-refresh fixhub-spin"),e("button.close",i).show(),i.find("input").removeAttr("disabled"),o||Fixhub.Environments.add(n)},error:function(t,n,o){e(".callout-danger",i).show();var s=n.responseJSON;e(".has-error",i).removeClass("has-error"),e(".label-danger",i).remove(),e("form input",i).each(function(t,n){n=e(n);var a=n.attr("name");if(void 0!==s[a]){var i=n.parent("div");i.addClass("has-error"),i.append(e("<span>").attr("class","label label-danger").text(s[a]))}}),a.removeClass("ion-refresh fixhub-spin"),e("button.close",i).show(),i.find("input").removeAttr("disabled")}})}),Fixhub.Environment=Backbone.Model.extend({urlRoot:"/environments",initialize:function(){}});var t=Backbone.Collection.extend({model:Fixhub.Environment});Fixhub.Environments=new t,Fixhub.EnvironmentsTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#environment_list tbody"),e("#no_environments").show(),e("#environment_list").hide(),this.listenTo(Fixhub.Environments,"add",this.addOne),this.listenTo(Fixhub.Environments,"reset",this.addAll),this.listenTo(Fixhub.Environments,"remove",this.addAll),this.listenTo(Fixhub.Environments,"all",this.render),Fixhub.listener.on("environment:Fixhub\\Bus\\Events\\ModelChangedEvent",function(t){e("#environment_"+t.model.id).html(t.model.name);var n=Fixhub.Environments.get(parseInt(t.model.id));n&&n.set(t.model)}),Fixhub.listener.on("environment:Fixhub\\Bus\\Events\\ModelCreatedEvent",function(t){var n=e('input[name="targetable_type"]').val(),a=e('input[name="targetable_id"]').val();n==t.model.targetable_type&&parseInt(t.model.targetable_id)===parseInt(a)&&Fixhub.Environments.add(t.model)}),Fixhub.listener.on("environment:Fixhub\\Bus\\Events\\ModelTrashedEvent",function(e){var t=Fixhub.Environments.get(parseInt(e.model.id));t&&Fixhub.Environments.remove(t)})},render:function(){Fixhub.Environments.length?(e("#no_environments").hide(),e("#environment_list").show()):(e("#no_environments").show(),e("#environment_list").hide())},addOne:function(t){var n=new Fixhub.EnvironmentView({model:t});this.$list.append(n.render().el),Fixhub.Environments.length<2?e(".drag-handle",this.$list).hide():e(".drag-handle",this.$list).show()},addAll:function(){this.$list.html(""),Fixhub.Environments.each(this.addOne,this)}}),Fixhub.EnvironmentView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"edit","click .btn-delete":"trash"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#environment-template").html())},render:function(){var e=this.model.toJSON();return e.last_run=null!=e.last_run?moment(e.last_run).fromNow():trans("app.never"),this.$el.html(this.template(e)),this},edit:function(){e("#environment_id").val(this.model.id),e("#environment_name").val(this.model.get("name")),e("#environment_description").val(this.model.get("description")),e("#environment_default_on").prop("checked",!0===this.model.get("default_on"))},trash:function(){var t=e("#model_id");t.val(this.model.id),t.parents(".modal").removeClass().addClass("modal fade environment-trash")}})}(jQuery),function(e){e("#sharedfile").on("show.bs.modal",function(t){var n=e(t.relatedTarget),a=e(this),i=trans("sharedFiles.create");e(".btn-danger",a).hide(),e(".callout-danger",a).hide(),e(".has-error",a).removeClass("has-error"),e(".label-danger",a).remove(),n.hasClass("btn-edit")?(i=trans("sharedFiles.edit"),e(".btn-danger",a).show()):(e("#sharedfile_id").val(""),e("#name").val(""),e("#file").val("")),a.find(".modal-title span").text(i)}),e("body").delegate(".sharedfile-trash button.btn-delete","click",function(t){var n=e(t.currentTarget),a=n.find("i"),i=n.parents(".modal");a.addClass("ion-refresh fixhub-spin"),i.find("input").attr("disabled","disabled"),e("button.close",i).hide(),Fixhub.SharedFiles.get(e("#model_id").val()).destroy({wait:!0,success:function(t,n,o){i.modal("hide"),e(".callout-danger",i).hide(),a.removeClass("ion-refresh fixhub-spin"),e("button.close",i).show(),i.find("input").removeAttr("disabled")},error:function(){a.removeClass("ion-refresh fixhub-spin"),e("button.close",i).show(),i.find("input").removeAttr("disabled")}})}),e("#sharedfile button.btn-save").on("click",function(t){var n=e(t.currentTarget),a=n.find("i"),i=n.parents(".modal");a.addClass("ion-refresh fixhub-spin"),i.find("input").attr("disabled","disabled"),e("button.close",i).hide();var o=e("#sharedfile_id").val();if(o)var s=Fixhub.SharedFiles.get(o);else var s=new Fixhub.SharedFile;s.save({name:e("#name").val(),file:e("#file").val(),targetable_type:e('input[name="targetable_type"]').val(),targetable_id:e('input[name="targetable_id"]').val()},{wait:!0,success:function(t,n,s){i.modal("hide"),e(".callout-danger",i).hide(),a.removeClass("ion-refresh fixhub-spin"),e("button.close",i).show(),i.find("input").removeAttr("disabled"),o||Fixhub.SharedFiles.add(n)},error:function(t,n,o){e(".callout-danger",i).show();var s=n.responseJSON;e(".has-error",i).removeClass("has-error"),e(".label-danger",i).remove(),e("form input",i).each(function(t,n){n=e(n);var a=n.attr("name");if(void 0!==s[a]){var i=n.parent("div");i.addClass("has-error"),i.append(e("<span>").attr("class","label label-danger").text(s[a]))}}),a.removeClass("ion-refresh fixhub-spin"),e("button.close",i).show(),i.find("input").removeAttr("disabled")}})}),Fixhub.SharedFile=Backbone.Model.extend({urlRoot:"/shared-files"});var t=Backbone.Collection.extend({model:Fixhub.SharedFile});Fixhub.SharedFiles=new t,Fixhub.SharedFilesTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#sharedfile_list tbody"),e("#no_sharedfiles").show(),e("#sharedfile_list").hide(),this.listenTo(Fixhub.SharedFiles,"add",this.addOne),this.listenTo(Fixhub.SharedFiles,"reset",this.addAll),this.listenTo(Fixhub.SharedFiles,"remove",this.addAll),this.listenTo(Fixhub.SharedFiles,"all",this.render),Fixhub.listener.on("sharedfile:Fixhub\\Bus\\Events\\ModelChangedEvent",function(e){var t=Fixhub.SharedFiles.get(parseInt(e.model.id));t&&t.set(e.model)}),Fixhub.listener.on("sharedfile:Fixhub\\Bus\\Events\\ModelCreatedEvent",function(t){var n=e('input[name="targetable_type"]').val(),a=e('input[name="targetable_id"]').val();n==t.model.targetable_type&&parseInt(t.model.targetable_id)===parseInt(a)&&Fixhub.SharedFiles.add(t.model)}),Fixhub.listener.on("sharedfile:Fixhub\\Bus\\Events\\ModelTrashedEvent",function(e){var t=Fixhub.SharedFiles.get(parseInt(e.model.id));t&&Fixhub.SharedFiles.remove(t)})},render:function(){Fixhub.SharedFiles.length?(e("#no_sharedfiles").hide(),e("#sharedfile_list").show()):(e("#no_sharedfiles").show(),e("#sharedfile_list").hide())},addOne:function(e){var t=new Fixhub.SharedFileView({model:e});this.$list.append(t.render().el)},addAll:function(){this.$list.html(""),Fixhub.SharedFiles.each(this.addOne,this)}}),Fixhub.SharedFileView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"edit","click .btn-delete":"trash"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#sharedfile-template").html())},render:function(){var e=this.model.toJSON();return this.$el.html(this.template(e)),this},edit:function(){e("#sharedfile_id").val(this.model.id),e("#name").val(this.model.get("name")),e("#file").val(this.model.get("file"))},trash:function(){var t=e("#model_id");t.val(this.model.id),t.parents(".modal").removeClass().addClass("modal fade sharedfile-trash")}})}(jQuery),function(e){e("#variable").on("show.bs.modal",function(t){var n=e(t.relatedTarget),a=e(this),i=trans("variables.create");e(".btn-danger",a).hide(),e(".callout-danger",a).hide(),e(".has-error",a).removeClass("has-error"),e(".label-danger",a).remove(),n.hasClass("btn-edit")?(i=trans("variables.edit"),e(".btn-danger",a).show()):(e("#variable_id").val(""),e("#variable_name").val(""),e("#variable_value").val("")),a.find(".modal-title span").text(i)}),e("body").delegate(".variable-trash button.btn-delete","click",function(t){var n=e(t.currentTarget),a=n.find("i"),i=n.parents(".modal");a.addClass("ion-refresh fixhub-spin"),i.find("input").attr("disabled","disabled"),e("button.close",i).hide(),Fixhub.Variables.get(e("#model_id").val()).destroy({wait:!0,success:function(t,n,o){i.modal("hide"),e(".callout-danger",i).hide(),a.removeClass("ion-refresh fixhub-spin"),e("button.close",i).show(),i.find("input").removeAttr("disabled")},error:function(){a.removeClass("ion-refresh fixhub-spin"),e("button.close",i).show(),i.find("input").removeAttr("disabled")}})}),e("#variable button.btn-save").on("click",function(t){var n=e(t.currentTarget),a=n.find("i"),i=n.parents(".modal");a.addClass("ion-refresh fixhub-spin"),i.find("input").attr("disabled","disabled"),e("button.close",i).hide();var o=e("#variable_id").val();if(o)var s=Fixhub.Variables.get(o);else var s=new Fixhub.Variable;s.save({name:e("#variable_name").val(),value:e("#variable_value").val(),targetable_type:e('input[name="targetable_type"]').val(),targetable_id:e('input[name="targetable_id"]').val()},{wait:!0,success:function(t,n,s){i.modal("hide"),e(".callout-danger",i).hide(),a.removeClass("ion-refresh fixhub-spin"),e("button.close",i).show(),i.find("input").removeAttr("disabled"),o||Fixhub.Variables.add(n)},error:function(t,n,o){e(".callout-danger",i).show();var s=n.responseJSON;e(".has-error",i).removeClass("has-error"),e(".label-danger",i).remove(),e("form input",i).each(function(t,n){n=e(n);var a=n.attr("name");if(void 0!==s[a]){var i=n.parent("div");i.addClass("has-error"),i.append(e("<span>").attr("class","label label-danger").text(s[a]))}}),a.removeClass("ion-refresh fixhub-spin"),e("button.close",i).show(),i.find("input").removeAttr("disabled")}})}),Fixhub.Variable=Backbone.Model.extend({urlRoot:"/variables",initialize:function(){}});var t=Backbone.Collection.extend({model:Fixhub.Variable});Fixhub.Variables=new t,Fixhub.VariablesTab=Backbone.View.extend({el:"#app",events:{},initialize:function(){this.$list=e("#variable_list tbody"),e("#no_variables").show(),e("#variable_list").hide(),this.listenTo(Fixhub.Variables,"add",this.addOne),this.listenTo(Fixhub.Variables,"reset",this.addAll),this.listenTo(Fixhub.Variables,"remove",this.addAll),this.listenTo(Fixhub.Variables,"all",this.render),Fixhub.listener.on("variable:Fixhub\\Bus\\Events\\ModelChangedEvent",function(t){e("#variable_"+t.model.id).html(t.model.name);var n=Fixhub.Variables.get(parseInt(t.model.id));n&&n.set(t.model)}),Fixhub.listener.on("variable:Fixhub\\Bus\\Events\\ModelCreatedEvent",function(t){var n=e('input[name="targetable_type"]').val(),a=e('input[name="targetable_id"]').val();n==t.model.targetable_type&&parseInt(t.model.targetable_id)===parseInt(a)&&Fixhub.Variables.add(t.model)}),Fixhub.listener.on("variable:Fixhub\\Bus\\Events\\ModelTrashedEvent",function(e){var t=Fixhub.Variables.get(parseInt(e.model.id));t&&Fixhub.Variables.remove(t)})},render:function(){Fixhub.Variables.length?(e("#no_variables").hide(),e("#variable_list").show()):(e("#no_variables").show(),e("#variable_list").hide())},addOne:function(e){var t=new Fixhub.VariableView({model:e});this.$list.append(t.render().el)},addAll:function(){this.$list.html(""),Fixhub.Variables.each(this.addOne,this)}}),Fixhub.VariableView=Backbone.View.extend({tagName:"tr",events:{"click .btn-edit":"edit","click .btn-delete":"trash"},initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.template=_.template(e("#variable-template").html())},render:function(){var e=this.model.toJSON();return this.$el.html(this.template(e)),this},edit:function(){e("#variable_id").val(this.model.id),e("#variable_name").val(this.model.get("name")),e("#variable_value").val(this.model.get("value"))},trash:function(){var t=e("#model_id");t.val(this.model.id),t.parents(".modal").removeClass().addClass("modal fade variable-trash")}})}(jQuery);